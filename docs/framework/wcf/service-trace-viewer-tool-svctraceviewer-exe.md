---
title: サービス トレース ビューアー ツール (SvcTraceViewer.exe)
description: サービストレースビューアーを使用して、ログ内のトレースメッセージをマージ、表示、およびフィルター処理して、WCF サービスの問題を診断、修復、および検証できるようにします。
ms.date: 03/30/2017
ms.assetid: 9027efd3-df8d-47ed-8bcd-f53d55ed803c
ms.openlocfilehash: 0ad6094965291a965346522688a8334abbd4e6b3
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/23/2020
ms.locfileid: "85244570"
---
# <a name="service-trace-viewer-tool-svctraceviewerexe"></a>サービス トレース ビューアー ツール (SvcTraceViewer.exe)

Windows Communication Foundation (WCF) サービストレースビューアーツールは、WCF によって生成される診断トレースを分析するのに役立ちます。 サービストレースビューアーを使用すると、ログ内のトレースメッセージを簡単にマージ、表示、およびフィルター処理して、WCF サービスの問題を診断、修復、および検証することができます。

## <a name="configuring-tracing"></a>トレースの構成

診断トレースは、アプリケーションの操作で発生している内容を示す情報を提供します。 名前が示すように、操作を開始点から中間点を通過して終了点まで追跡できます。

アプリケーションの構成ファイル (Web ホストアプリケーションの場合は Web.config、自己ホスト型アプリケーションの場合は*Appname*) を使用して、トレースを構成できます。 次に例を示します。

```xml
<system.diagnostics>
    <trace autoflush="true" />
    <sources>
            <source name="System.ServiceModel"
                    switchValue="Information, ActivityTracing"
                    propagateActivity="true">
            <listeners>
               <add name="sdt"
                   type="System.Diagnostics.XmlWriterTraceListener"
                   initializeData= "SdrConfigExample.e2e" />
            </listeners>
         </source>
    </sources>
</system.diagnostics>
```

この例では、トレース リスナーの名前と種類が指定されています。 リスナーに `sdt` という名前を付け、使用する種類として標準の .NET Framework トレース リスナー (System.Diagnostics.XmlWriterTraceListener) を追加しています。 属性を使用して、 `initializeData` そのリスナーのログファイルの名前をに設定し `SdrConfigExample.e2e` ます。 ログ ファイルは、単純なファイル名と完全修飾パスを置き換えることができます。

この例では、SdrConfigExample.e2e という名前のルート ディレクトリにファイルが作成されています。 トレースビューアーを使用して、「WCF トレースファイルを開いて表示する」セクションの説明に従ってファイルを開くと、送信されたすべてのメッセージが表示されます。

トレース レベルは `switchValue` 設定で制御します。 使用できるトレース レベルを次の表に示します。

|トレース レベル|説明|
|-----------------|-----------------|
|重大|-フェールファーストおよびイベントログのエントリをログに記録し、相関関係情報をトレースします。 Critical レベルを使用する可能性が高い場合の例を次に示します。<br />-ハンドルされない例外が発生したため、AppDomain が停止しました。<br />-アプリケーションを起動できません。<br />-エラーの原因となったメッセージが MyApp.exe プロセスから発生しました。|
|エラー|-すべての例外をログに記録します。 Error レベルは、次のような場合に使用できます。<br />-無効なキャスト例外が発生したため、コードがクラッシュしました。<br />-"エンドポイントを作成できませんでした" という例外が発生すると、アプリケーションが起動時に失敗します。|
|警告|-その後、エラーまたは重大なエラーが発生する可能性がある条件が存在します。 このレベルは次のような場合に使用できます。<br />-アプリケーションは、制限設定によって許可されているよりも多くの要求を受信しています。<br />-受信キューは、構成されている容量の98% に達しています。|
|Information|-システムの状態の監視と診断、パフォーマンスの測定、またはプロファイリングに役立つメッセージが生成されます。 キャパシティ プランニングやパフォーマンス管理のためにこの情報を利用できます。 このレベルは次のような場合に使用できます。<br />-メッセージが AppDomain に到達し、逆シリアル化された後でエラーが発生しました。<br />-HTTP バインドの作成中にエラーが発生しました。|
|"詳細"|-ユーザーコードとサービスの両方に対するデバッグレベルのトレース。 このレベルは次のような場合に設定します。<br />-エラーが発生したときに、コード内のどのメソッドが呼び出されたかわからない。<br />-正しくないエンドポイントが構成されており、予約ストアのエントリがロックされているため、サービスを開始できませんでした。|
|ActivityTracing|処理アクティビティとコンポーネント間のフロー イベント。<br /><br /> このレベルを使用すると、管理者と開発者は同じアプリケーション ドメイン内のアプリケーションの相関関係を示すことができます。<br /><br /> -アクティビティ境界のトレース: start/stop。<br />-転送のトレース。|

 `add` を使用して、使用するトレース リスナーの名前と種類を指定できます。 この例の構成では、リスナーに `sdt` という名前を付け、使用する種類として標準の .NET Framework トレース リスナー (`System.Diagnostics.XmlWriterTraceListener`) を追加しています。 `initializeData` を使用して、そのリスナーのログ ファイルの名前を設定します。 さらに、単純なファイル名の代わりに完全修飾パスを使用できます。

.NET Framework 4.8 以降では、ハイコントラストテーマの ComboBox コントロールが正しい色で表示されます。 この変更を無効にするには、 *svcTraceViewer.exe.config*ファイルから次の設定を削除します。

```xml
<AppContextSwitchOverrides value="Switch.UseLegacyAccessibilityFeatures=false;Switch.UseLegacyAccessibilityFeatures.2=false" />
```

## <a name="using-the-service-trace-viewer-tool"></a>サービス トレース ビューアー ツールの使用

### <a name="opening-and-viewing-wcf-trace-files"></a>WCF トレース ファイルを開いて表示する

サービス トレース ビューアーは、次の 3 種類のファイルをサポートします。

- WCF トレースファイル (. .Svclog)

- イベント トレース ファイル (.etl)

- Crimson トレース ファイル

 サービス トレース ビューアーを使用すると、サポートされているトレース ファイルを開いたり、トレース ファイルを追加して統合したりできます。トレース ファイルのグループを同時に開いてマージすることもできます。

##### <a name="to-open-a-trace-file"></a>トレース ファイルを開くには

1. コマンドウィンドウを使用してサービストレースビューアーを起動し、WCF のインストール場所 (C:\Program SDKs\Windows\v6.0\Bin) に移動して、「」と入力し `SvcTraceViewer.exe` ます。

> [!NOTE]
> サービス トレース ビューアー ツールは、2 種類のファイル .svclog と .stvproj を関連付けることができます。 コマンド ラインで 2 つのパラメーターを使用して、ファイル拡張子を登録および登録解除できます。
>
> /register: SvcTraceViewer.exe がファイル拡張 ".svclog" と ".stvproj" の関連付けを登録します。
>
> /unregister: SvcTraceViewer.exe への ".svclog" と ".stvproj" の関連付けの登録を解除します。

1. サービストレースビューアーが起動したら、[**ファイル**] をクリックし、[**開く**] をポイントします。 トレース ファイルが格納されている場所に移動します。

2. 開くトレース ファイルをダブルクリックします。

    > [!NOTE]
    > 複数のトレース ファイルを同時に選択して開くには、Shift キーを押しながら、複数のトレース ファイルをクリックします。 サービス トレース ビューアーは、すべてのファイルの内容をマージし、1 つのビューで表示します。 たとえば、クライアントとサービスの両方のトレース ファイルを開くことができます。 これは、構成でメッセージ ログとアクティビティ伝達を有効にしている場合に役立ちます。 この方法では、クライアントとサービスのメッセージ交換を調べることができます。 また、ビューアーに複数のファイルをドラッグしたり、[**プロジェクト**] タブを使用したりすることもできます。詳細については、「プロジェクトの管理」セクションを参照してください。

3. 開いているコレクションにトレースファイルを追加するには、[**ファイル**] をクリックし、[**追加**] をポイントします。 開いているウィンドウで、トレース ファイルの場所に移動し、追加するファイルをダブルクリックします。

> [!CAUTION]
> 200 MB を超えるトレース ログ ファイルを読み込むことはお勧めできません。 この制限を超えるファイルを読み込もうとすると、使用するコンピューター リソースによっては読み込みプロセスに時間がかかる場合があります。 サービス トレース ビューアー ツールが長時間応答しない場合や、コンピューターのメモリを使い果たしてしまう場合があります。 これを回避するには、部分読み込みを構成することをお勧めします。 部分読み込みの方法の詳細については、「規模の大きいトレース ファイルの読み込み」セクションを参照してください。

#### <a name="event-tracing-and-crimson-tracing"></a>イベント トレースと Crimson トレース

ビューアーのネイティブ形式は、WCF が生成するアクティビティトレース形式です。 別の形式で出力されるトレースは、ビューアーが表示する前に変換される必要があります。 現在では、ビューアーはアクティビティ トレース形式の他に、イベント トレースと Crimson トレースをサポートします。

アクティビティ トレースを含まないファイルを開くと、ビューアーはそのファイルを変換しようとします。 変換されるトレース データを含むファイルの名前と場所を指定する必要があります。 データが変換されたら、ビューアーは新しいファイルの内容を表示します。

> [!NOTE]
> 変換には、変換後のトレース データを格納するためのディスク領域が必要です。 変換を開始する前にデータを格納するための十分な空きディスク領域を確保してください。 そうでない場合、変換は失敗します。

### <a name="managing-projects"></a>プロジェクトの管理

ビューアーは、複数のトレース ファイルの表示を容易にするためにプロジェクトをサポートします。 たとえば、クライアントとサービスの両方のトレース ファイルがある場合は、それらをプロジェクトに追加できます。 追加したら、プロジェクトを開くたびに、プロジェクト内のすべてのトレース ファイルが同時に読み込まれます。

プロジェクトの管理には、次の 2 つの方法があります。

- [**ファイル**] メニューでは、プロジェクトを開いて保存し、閉じることができます。

- [**プロジェクト**] タブでは、プロジェクトにファイルを追加できます。

### <a name="viewing-wcf-traces"></a>WCF トレースの表示

WCF は、アクティビティトレース形式を使用してトレースを出力します。 アクティビティ トレース モデルでは、各トレースはそれぞれの目的に従ってアクティビティにグループ化されます。 論理制御フローは、アクティビティ間で転送されます。 たとえば、アプリケーションの有効期間の間、多くの "メッセージ送信アクティビティ" が出現したり消えたりします。 トレースとアクティビティの表示、およびサービストレースビューアーのユーザーインターフェイスの詳細については、「[サービストレースビューアーを使用した相関トレースの表示とトラブルシューティング](./diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md)」を参照してください。

#### <a name="switching-to-different-views"></a>別のビューへの切り替え

サービス トレース ビューアーは、次の別のビューを提供します。 これらは、ビューアーの左側のウィンドウにタブとして表示され、[**表示**] メニューからもアクセスできます。

- アクティビティ ビュー

- [Project View (プロジェクト ビュー)]

- メッセージ ビュー

- グラフ ビュー

##### <a name="activity-view"></a>アクティビティ ビュー

トレースファイルを開くと、トレースがアクティビティにグループ化され、左側のウィンドウの [**アクティビティ**] ビューに表示されます。

アクティビティ**ビューに**は、アクティビティ名、アクティビティ内のトレース数、期間、開始時刻、終了時刻が表示されます。

表示されたアクティビティのいずれかをクリックすると、そのアクティビティ内のトレースが右側のトレース ペインに表示されます。 その詳細を表示するトレースを選択できます。

複数のアクティビティを選択するには、 **Ctrl**キーまたは**Shift**キーを押しながら目的のアクティビティをクリックします。 トレース ペインは、選択されたアクティビティのすべてのトレースを表示します。

アクティビティをダブルクリックすると、**グラフ**ビューに表示できます。 別の方法として、アクティビティを選択し、**グラフ**ビューに切り替える方法もあります。

> [!NOTE]
> アクティビティ "000000000000" は、グラフビューに表示できない特別なアクティビティです。 他のすべてのアクティビティがリンクされているため、このアクティビティを表示すると、パフォーマンスに深刻な影響が生じます。

列のタイトルをクリックすると、アクティビティ一覧が並べ替えられます。 警告トレースを含むアクティビティは黄色の背景を持ち、エラー トレースを含むアクティビティは赤色の背景を持ちます。

さまざまな種類のアクティビティがあり、それぞれの種類は各アクティビティの左側にあるアイコンに対応します。 それぞれのアイコンの意味については、「トレース アイコンの理解」セクションを参照してください。

##### <a name="project-view"></a>[Project View (プロジェクト ビュー)]

このビューを使用すると、現在のプロジェクトのトレース ファイルを管理できます。 詳細については、「プロジェクトの管理」セクションを参照してください。

##### <a name="message-view"></a>メッセージ ビュー

このビューでは、Action、Date/Time、Process、アクティビティ、From/To などのすべてのメッセージログトレースを表示し、関連付けられているメッセージログトレースの詳細に移動できます。 メッセージフローのナビゲーションを容易にするために、アクティビティの境界、プロセス/スレッド、または送信 & 受信によってメッセージログトレースをグループ化することができます。

##### <a name="graph-view"></a>グラフ ビュー

このビューには、特定のアクティビティのトレースデータがグラフ形式で表示されます。 グラフ形式を使用すると、イベントのステップ実行やデータが複数のアクティビティ間を移動するときのそれらの相互関係を確認できます。

**グラフ**ビューに切り替えるには、**アクティビティ**ビューでアクティビティを選択し、[**アクティビティ**] タブをクリックするか、**メッセージ**ビューでメッセージログトレースをクリックします。 複数のトレース ファイルが読み込まれ、アクティビティが複数のファイルのトレースに関係している場合は、関連するすべてのトレースがグラフ ビューに表示されます。 アクティビティとメッセージログトレースをダブルクリックすると、**グラフ**ビューにも表示されます。

**グラフ**ビューでは、各垂直列はアクティビティを表し、列内の各ブロックはトレースを表します。 アクティビティは、プロセス (またはスレッド) によってグループ化されます。 アクティビティ間の小さな矢印は、転送を表します。 プロセス間の大きな矢印は、メッセージ交換を表します。 選択範囲のアクティビティは、常に黄色です。

###### <a name="selecting-traces-in-the-graph"></a>グラフでのトレースの選択

1. グラフ内のブロックをクリックします。

2. 上方向キーや下方向キーを使用して、隣接するトレースを選択します。

3. トレース ペインや詳細ペインでトレース情報を確認します。

###### <a name="expanding-or-collapsing-activity-transfers"></a>アクティビティ転送の展開または折りたたみ

選択範囲のアクティビティが別のアクティビティに転送されるとき、アクティビティ転送を展開できます。 展開によって、転送を追跡できます。

アクティビティ転送を展開または折りたたむには

1. 転送アイコンの左側にある "+" 記号を使用して転送トレースを見つけます。

2. [+] をクリックするか、キーボードを使用して**Ctrl**キーと "+" キーを押します。

3. 次のアクティビティが、グラフに表示されます。

4. 転送アイコンの左側に "-" が表示されます。 "-" 記号をクリックするか、Ctrl キーと "-" キーを押すと、アクティビティ転送が折りたたまれます。

> [!NOTE]
> アクティビティに複数の転送があるとき、転送の 1 つを展開すると、ルート アクティビティから新しいアクティビティまでのアクティビティが表示されます。 これらの新しいアクティビティは、折りたたまれた形式で表示されます。 これらのアクティビティの詳細を確認する場合は、グラフのヘッダーにある展開アイコンをクリックすると、これらのアクティビティが垂直方向に展開されます。

###### <a name="expanding-or-collapsing-activities-vertically"></a>垂直方向へのアクティビティの展開または折りたたみ

アクティビティを折りたたむと、ビューアーは、アクティビティ グラフで不要な詳細を非表示にします。 折りたたまれたアクティビティでは、個々のトレースは表示されません。 転送トレースだけが表示されます。 アクティビティのすべてのトレースを表示する場合は、グラフのヘッダーにあるアクティビティの展開記号をクリックすると、アクティビティが垂直方向に展開されます。

アクティビティを垂直方向に展開または折りたたむには

1. アクティビティヘッダーの [+] アイコンをクリックすると、アクティビティが垂直方向に展開されます。

2. すべてのトレースがグラフに表示されます。

3. アクティビティヘッダーの "-" アイコンをクリックすると、アクティビティが垂直方向に折りたたまれます。

4. 重要な転送、メッセージ ログ、警告トレース、および例外トレースだけがアクティビティに表示されます。

###### <a name="options"></a>オプション

グラフビューの [**オプション**] メニューから2つのオプションを選択できます。

- [Show Activity Boundary Traces] は、オフにすると、グラフでアクティビティ境界トレースが無視されます。

- [Show Non-message Verbose Traces] は、オフにすると、メッセージ トレース以外の Verbose レベルのトレースが無視されます。 ほとんどの場合、詳細レベルのトレースは分析には重要ではありません。 このオプションは、詳細レベルのトレースを分析しないで、重要なトレースだけに絞る場合に役立ちます。

###### <a name="layout-mode"></a>レイアウト モード

ビューアーには、**プロセス**と**スレッド**という2つのレイアウトモードがあります。 この設定は、編成の最大の単位を定義します。 既定のレイアウトモードは [**プロセス**] です。これは、アクティビティがグラフ内のプロセス別にグループ化されることを意味します。

###### <a name="execution-list"></a>実行リスト

グラフで表示されるプロセスまたはスレッドをこのドロップダウン リストから選択できます。 たとえば、2 つ (A と B) のクライアントと 1 つのサービスのトレース ファイルが開いているときに、サービスとクライアント A だけをグラフに表示する場合は、リストからクライアント B の選択を解除します。

#### <a name="viewing-trace-details"></a>トレース詳細の表示

トレース詳細を表示するには、トレース ペインでトレースを選択します。 詳細が、詳細ペインに表示されます。

##### <a name="trace-pane"></a>トレース ペイン

サービス トレース ビューアーの右上のペインがトレース ペインです。 トレース ペインは、選択されたアクティビティのすべてのトレースを、トレース レベル、スレッド ID、プロセス名などの情報と共に表示します。

トレースを右クリックし、[**トレースをクリップボードにコピー**] を選択すると、トレースの未加工 XML をクリップボードにコピーできます。

##### <a name="detail-pane"></a>詳細ペイン

サービス トレース ビューアーの左下のペインが詳細ペインです。 詳細ペインには、トレース詳細を表示するために 3 つのタブがあります。

**書式付き**ビューでは、より整理された方法で情報が表示されます。 このビューは、テーブルとツリーの既知のすべての XML 要素の情報を判読しやすいように表示します。

**Xml**ビューには、選択したトレースに対応する xml が表示されます。 このビューは、強調表示と構文色をサポートします。 [**検索] を使用し**て文字列を検索すると、検索結果が強調表示されます。

メッセージ**ビューに**は、XML のメッセージ部分がメッセージログトレースに表示されます。 メッセージ以外のトレースを選択すると、このビューは非表示になります。

### <a name="filtering-wcf-traces"></a>WCF トレースのフィルター処理

トレースの分析を容易に行うために、次の方法でフィルター処理します。

- フィルター ツール バーから定義済みのフィルターとカスタム フィルターにアクセスできます。 これは、[**表示**] メニューから有効にすることができます。

- ビューアーの事前定義されたフィルターを使用して、WCF トレースの一部を選択的にフィルター処理できます。 既定では、すべてのインフラストラクチャ トレースが通過できるように設定されます。 このフィルターの設定は、[**表示**] メニューの [**フィルターオプション**] サブメニューで定義されています。

- カスタム XPath フィルターを使用すると、フィルター処理を完全に制御できます。 これらは、[**表示**] メニューの [**カスタムフィルター** ] で定義できます。

すべてのフィルターを通過するトレースだけが表示されます。

#### <a name="using-the-filter-toolbar"></a>フィルター ツール バーの使用

フィルター ツール バーは、ツールの上部に表示されます。 表示されていない場合は、[**表示**] メニューでアクティブにすることができます。 バーには、3 つのコンポーネントがあります。

- [検索対象 **: 検索対象**のフィルター操作で検索する件名を定義します。 たとえば、プロセス X のコンテキストで出力されたすべてのトレースを検索する場合は、このフィールドを [X] に設定し、[**検索**対象] フィールドを [プロセス名] に設定します。 時間ベースのフィルターを選択すると、このフィールドは、DateTime セレクター コントロールに変更されます。

- 探す場所: このフィールドは、適用するフィルターの種類を定義します。

- レベル: レベル設定では、フィルターが許容する最小トレース レベルを定義します。 たとえば、レベルが Error と Up に設定されている場合は、Error レベルと Critical レベルのトレースだけが表示されます。 このフィルターは、検索対象と検索場所で指定された検索条件と組み合わせます。

[**今すぐフィルター** ] ボタンをクリックすると、フィルター操作が開始されます。 一部のフィルターは、特に大規模なデータ セットに適用される場合は完了に長時間かかります。 フィルター操作を取り消すには、[**操作**] メニューのステータスバーに表示される [**停止**] ボタンをクリックします。

[**クリア**] ボタンをクリックすると、定義済みフィルターとカスタムフィルターがリセットされ、すべてのトレースが通過できるようになります。

#### <a name="filter-options"></a>フィルター オプション

ビューアーは、ビューから WCF トレースを自動的に削除できます。 トランザクション関連のトレースをビューから削除するなど、WCF の特定の領域から出力されるトレースを選択的に削除できます。

このフィルターの設定は、[**表示**] メニューの [**フィルターオプション**] サブメニューで定義されています。

#### <a name="custom-filters"></a>カスタム フィルター

XML パス言語 (XPath) に慣れている場合は、その言語でカスタム フィルターを構築して、トレース データから関係する任意の XML 要素を検索できます。 フィルターには、フィルター ツール バーからアクセスできます。

カスタム フィルターは、パラメーターを含むことができます。 既存のカスタム フィルターをインポートすることもできます。

##### <a name="creating-a-custom-filter"></a>カスタム フィルターの作成

フィルターは、次の 2 つの方法で作成できます。

###### <a name="creating-a-custom-filter-using-the-template-wizard"></a>テンプレート ウィザードを使用したカスタム フィルターの作成

既存のトレースをクリックし、トレースの構造に基づいてフィルターを作成できます。 この例では、スレッド ID に基づいてカスタム フィルターを作成します。

1. ビューアーの右上にあるトレース ペインで、フィルター処理する要素を含むトレースを選択します。

2. トレースペインの上部にある [**カスタムフィルターの作成**] ボタンをクリックします。

3. 表示されるダイアログ ボックスにフィルターの名前を入力します。 この例では、「」と入力し `Thread ID` ます。 また、フィルターの説明も提供できます。

4. 左側のツリー ビューは、手順 1. で選択したトレース レコードの構造を表示します。 検索条件の作成対象となる要素を参照します。 この例では、XPath: ノードに配置される ThreadID を参照し /E2ETraceEvent/System/Execution/@ThreadID ます。 ツリー ビューで ThreadID 属性をダブルクリックします。 これにより、ダイアログの右側に属性の式が作成されます。

5. ThreadID 条件のパラメーターフィールドを None から ' ' に変更 {0} します。 この手順によって、フィルターの適用時に ThreadID 値を構成できます。 (「フィルターの適用方法」セクションを参照してください)。パラメーターは 4 つまで定義できます。 条件は、OR 演算子を使用して結合されます。

6. [ **Ok** ] をクリックしてフィルターを作成します。

> [!NOTE]
> テンプレート ウィザードを使用してフィルターを作成したら、編集を手動でのみ行うことができます。 以前に作成されたフィルターのウィザードをアクティブにすることはできません。 また、テンプレート ウィザードで作成された XPath フィルターの条件は、OR 演算子を使用して結合されます。 AND 演算子が必要な場合は、フィルター式の作成後に編集できます。

###### <a name="creating-a-custom-filter-manually"></a>手動によるカスタム フィルターの作成

カスタム フィルター メニューを使用すると、XPath フィルターを手動で入力できます。

1. [表示] メニューの [**カスタムフィルター** ] メニュー項目をクリックします。

2. 表示されるダイアログで、[新規] をクリックし**ます。**

3. 少なくともフィルター名と XPath 式を指定します。

4. **[OK]** をクリックします。

###### <a name="applying-a-custom-filter"></a>カスタム フィルターの適用

カスタム フィルターを作成したら、フィルター ツール バーからアクセスできます。 フィルターツールバーの [**検索する範囲**] フィールドで、適用するフィルターを選択します。 前の例では、「Thread ID」を選択します。

1. [**検索する文字列**] フィールドで、検索する値を指定します。 例では、検索するスレッドの ID を入力します。

2. [**今すぐフィルター**] をクリックして、操作の結果を確認します。

フィルターに複数のパラメーターが使用されている場合は、[**検索する文字列**] フィールドで区切り記号として '; ' を使用して入力します。 たとえば、‘1;findValue;text’ という文字列は、3 つのパラメーターを定義します。 ビューアーは、フィルターのパラメーターに ' 1 ' を適用し {0} ます。 ' findValue ' と ' text ' はそれぞれに適用され {1} {2} ます。

###### <a name="sharing-custom-filters"></a>カスタム フィルターの共有

カスタム フィルターは、異なるセッション間や異なるユーザー間で共有できます。 フィルターを定義ファイルにエクスポートしたり、このファイルを別の場所にインポートすることができます。

 カスタム フィルターをインポートするには

1. [**表示**] メニューの [**カスタムフィルター**] をクリックします。

2. 表示されるダイアログボックスで、[**インポート**] ボタンをクリックします。

3. カスタムフィルターファイル (stvcf) に移動し、ファイルをクリックして、[**開く**] ボタンをクリックします。

カスタム フィルターをエクスポートするには

1. [表示] メニューの [**カスタムフィルター**] をクリックします。

2. 開いているダイアログ ボックスで、エクスポートするフィルターを選択します。

3. [エクスポート****] ボタンをクリックします。

4. カスタムフィルター定義ファイル (stvcf) の名前と場所を指定し、[**保存**] ボタンをクリックします。

> [!NOTE]
> これらのカスタム フィルターは、サービス トレース ビューアーからのみインポートとエクスポートを実行できます。 他のツールで読み取ることはできません。

### <a name="finding-data"></a>データの検索

ビューアーは、データを検索する次の方法を提供します。

- 検索ツール バーを使用すると、最も一般的な検索オプションにすばやくアクセスできます。

- 検索ダイアログは、詳細な検索オプションを提供します。 [**編集**] メニュー、またはショートキー Ctrl + F を使用してアクセスできます。

検索ツール バーは、ビューアーの上部に表示されます。 表示されていない場合は、[**表示**] メニューでアクティブにすることができます。 バーには、2 つのコンポーネントがあります。

- Find What: 検索キーワードを入力できます。

- 検索場所: 検索範囲を入力できます。 すべてのアクティビティを検索するか、現在のアクティビティだけを検索するかを選択できます。

検索ダイアログは、2 つの追加オプションを提供します。

- Find target:

  - [未加工のログデータ] オプションでは、すべての生データでキーワードが検索されます。

  - "Xml Text" オプションおよび "XML 属性" オプションでは、XML 要素のみが検索されます。

  - "ログに記録されたメッセージ" オプションは、メッセージ内でのみキーワードを検索します。

- [ルートアクティビティを無視する]: 検索では、"000000000000" アクティビティのトレースが無視されます。 ルート アクティビティに数千のトレースがあり、その大部分が転送である場合は、これにより、規模の大きいトレース ファイルのパフォーマンスが強化されます。

### <a name="navigating-traces"></a>トレースの移動

アプリケーションの実行時には、トレースはステップごとに記録されます。このため、トレース内を移動すると、アプリケーションのデバッグに役立ちます。 サービス トレース ビューアーは、トレースを移動するさまざまな方法を提供します。

#### <a name="step-forward-or-backward"></a>ステップ前進またはステップ後退

各トレースをプログラムのコード行として検討する場合、ステップフォワードは Visual Studio 統合開発環境 (IDE) の "ステップオーバー" とよく似ています。 違いは、トレースではステップ後退もできることです。 ステップ前進は、アクティビティの次のトレースに移動することを意味します。

- ステップ前進: [**アクティビティ**] メニューを使用するか、F10 キーを押します。 トレースペインで、方向キー "down" を使用することもできます。

- ステップバック: [**アクティビティ**] メニューを使用するか、または [F9] を押します。 トレースペインで、矢印キーを使用することもできます。

> [!NOTE]
> これにより、別のプロセスまたは別のコンピューターで発生しているアクティビティに移動できます。これは、WCF メッセージが複数のコンピューターにまたがるアクティビティ Id を保持できるためです。

#### <a name="follow-transfer"></a>転送の追跡

転送トレースは、トレース ファイルの特別なトレースです。 アクティビティは、転送トレースによって別のアクティビティに転送できます。 たとえば、"アクティビティ A" を "アクティビティ B" に転送できます。 このような場合、"アクティビティ A" に "To: Activity" という名前の転送トレースと転送アイコンがあります。 この転送トレースは、2 つのトレース間のリンクです。 "アクティビティ B" では、アクティビティの最後に転送トレースが返され、"アクティビティ A" に転送される場合もあります。 これは、A が B を呼び出した後に B が返すプログラムの関数呼び出しに類似しています。

"転送の追跡" は、デバッガーでの "ステップイン" に似ています。 転送の追跡では、転送を A から B にまで追跡します。他のトレースにはまったく影響ありません。

転送を追跡するには、マウスを使用する場合とキーボードを使用する場合の 2 つの方法があります。

- マウスの使用 : トレース ペインで転送トレースをダブルクリックします。

- キーボード: 転送トレースを選択し、[**アクティビティ**] メニューの [フォロー転送] を使用するか、F11 キーを押します。

> [!NOTE]
> 多くの場合、アクティビティ A がアクティビティ B に転送すると、アクティビティ A は、アクティビティ B がアクティビティ A に転送を返すまで待機します。これは、アクティビティ B がアクティブにトレースしている間、アクティビティ A はトレースのログを記録しないことを意味します。 ただし、アクティビティ A が待機しないでトレースのログ記録を続行することも可能です。 また、アクティビティ B がアクティビティ A に転送を返さないことも可能です。したがって、アクティビティ転送は、この意味では関数呼び出しとは異なります。 グラフ ビューでアクティビティ転送をさらに理解することができます。

#### <a name="jump-to-next-or-previous-transfer"></a>次の転送または前の転送へのジャンプ

現在のアクティビティを分析する場合や複数のアクティビティが選択されている場合に選択されたアクティビティを分析する場合は、転送先のアクティビティをすばやく検索する必要があります。 "次の転送に移動" を使用すると、アクティビティで次の転送トレースを見つけることができます。 転送トレースを見つけたら、"フォロー転送" を使用して次のアクティビティにステップインできます。

- 次の転送に移動: [**アクティビティ**] メニューを使用するか、Ctrl + F10 キーを押します。

- 前の転送に移動: [**アクティビティ**] メニューを使用するか、Ctrl + F9 キーを押します。

#### <a name="navigate-in-graph-view"></a>グラフ ビュー内の移動

[アクティビティ] ペインと [トレース] ペイン内の移動はデバッグに似ていますが、**グラフ**ビューを使用すると、ナビゲーションのエクスペリエンスが大幅に向上します。 詳細については、「グラフビュー」セクションを参照してください。

### <a name="loading-large-trace-files"></a>規模の大きいトレース ファイルの読み込み

トレース ファイルは、非常に大きくなる可能性があります。 たとえば、"Verbose" レベルでトレースを有効にした場合、ネットワーク速度や通信パターンによっては、数分の実行で生成されるトレースファイルは、数百メガバイトまたはそれ以上になる可能性があります。

非常に大きなトレース ファイルをサービス トレース ビューアーで開くと、システムのパフォーマンスに悪影響を及ぼす可能性があります。 読み込み速度と読み込み後の応答時間が低下する可能性があります。 実速度は、ハードウェア構成によって異なる場合があります。 ほとんどの PC では、200 MB を超えるトレース ファイルを読み込むと、パフォーマンスに深刻な影響が生じます。 1 GB を超えるトレース ファイルの場合、ツールが、使用可能なすべてのメモリを使い果たし、非常に長い時間応答が停止する可能性があります。

サイズの大きいトレースファイルの分析での読み込みと応答時間の低下を回避するために、サービストレースビューアーには "部分読み込み" と呼ばれる機能が用意されています。これにより、一度にトレースのごく一部のみが読み込まれます。 たとえば、サーバー上で数日間実行して 1 GB を超えたトレース ファイルがあるとします。 エラーが発生してトレースを分析するとき、トレース ファイル全体を開く必要がありません。 代わりに、エラーが発生したと考えられる特定期間内のトレースを読み込むことができます。 範囲が狭いので、サービス トレース ビューアー ツールはファイルを高速に読み込み、ユーザーは狭い範囲のデータからエラーを特定することができます。

#### <a name="enabling-partial-loading"></a>部分読み込みの有効化

部分読み込みを手動で有効にする必要はありません。 読み込もうとするトレース ファイルのサイズ全体が 40 MB を超えると、読み込む部分を選択させるために、サービス トレース ビューアーは自動的に、部分読み込みのダイアログを表示します。

> [!NOTE]
> トレースは期間を通して均等に分散していない可能性があるため、部分読み込みのツール バーで指定する期間の長さは、示される読み込みサイズに比例していない可能性があります。 実際の読み込みサイズは、部分読み込みのダイアログで示される推定サイズよりも小さい可能性があります。

#### <a name="adjusting-partial-loading"></a>部分読み込みの調整

トレース ファイルを部分的に読み込んだ後に、読み込むデータ セットを変更したい場合があります。 これを行うには、ビューアーの上部にある部分読み込みのツール バーを調整します。

1. マウスでツール バーを移動するか、開始時刻と終了時刻を入力します。

2. [**調整**] ボタンをクリックします。

## <a name="understanding-trace-icons"></a>トレース アイコンの理解

次に示すのは、サービストレースビューアーツールがさまざまなアイテムを表すために、[**アクティビティ**ビュー]、[**グラフ**ビュー]、[**トレース**] ペインで使用するアイコンの一覧です。

> [!NOTE]
> カテゴリ化されていないトレース ("メッセージが閉じられている" など) にはアイコンがありません。

### <a name="activity-tracing-traces"></a>アクティビティ トレースのトレース

|アイコン|説明|
|----------|-----------------|
|![警告トレース](./media/7457c4ed-8383-4ac7-bada-bcb27409da58.gif "7457c4ed-8383-4ac7-bada-bcb27409da58")|Warning トレース: Warning レベルで出力されるトレース|
|![エラー トレース](./media/7d908807-4967-4f6d-9226-d52125db69ca.gif "7d908807-4967-4f6d-9226-d52125db69ca")|Error トレース : Error レベルで出力されるトレース|
|![アクティビティ開始トレース](./media/8a728f91-5f80-4a95-afe8-0b6acd6e0317.gif "8a728f91-5f8047 a95-afe805 b6acd6e0317")|アクティビティ Start トレース : アクティビティの開始をマークするトレース。 ここにはアクティビティの名前が指定されています。 アプリケーションのデザイナーや開発者として、プロセスまたはスレッドごとにアクティビティ ID につき 1 つのアクティビティ Start トレースを定義する必要があります。<br /><br /> アクティビティ ID がトレース相関対象のトレース ソースに反映されている場合、同じアクティビティ ID に対して Start (トレース ソースにつき 1 つ) が複数存在することがあります。 Start トレースは、ActivityTracing がトレース ソースで有効な場合に出力されます。|
|![アクティビティ停止トレース](./media/a0493e95-653e-4af8-84a4-4d09a400bc31.gif "a0493e95-653e-4af8-84a4-4d09a400bc31")|アクティビティ Stop トレース : アクティビティの終了をマークするトレース。 . ここにはアクティビティの名前が指定されています。 アプリケーションのデザイナーや開発者として、トレース ソースごとにアクティビティ ID につき 1 つのアクティビティ Stop トレースを定義する必要があります。 トレース時間の単位が十分に小さくない場合を除き、指定したトレース ソースからのトレースは、そのトレース ソースからアクティビティ Stop が出力された後には何も表示されません。 これが起こると、同じ時刻の 2 つのトレース (Stop を含む) が、交互に表示される場合があります。 アクティビティ ID がトレース相関対象のトレース ソースに反映されている場合、同じアクティビティ ID に対して Stop (トレース ソースにつき 1 つ) が複数存在することがあります。 Stop トレースは、ActivityTracing がトレース ソースで有効な場合に出力されます。|
|![アクティビティ中断トレース](./media/6f7f4191-df2b-4592-8998-8379769e2d32.gif "6f7f4191-df2b-4592-8998-8379769e2d32")|アクティビティ Suspend トレース: アクティビティが中断した時刻をマークするトレース。 アクティビティが再開されるまで、中断したアクティビティではトレースは出力されません。 アクティビティの中断とは、トレース ソースのスコープにおいてそのアクティビティで何も処理が行われていないことです。 トレースの中断/再開は、プロファイリングに便利です。 Suspend トレースは、ActivityTracing がトレース ソースで有効な場合に出力されます。|
|![アクティビティ再開トレース](./media/1060d9d2-c9c8-4e0a-9988-cdc2f7030f17.gif "1060d9d2-c9c8-4e0a-9988-cdc2f7030f17")|アクティビティ Resume トレース : アクティビティが中断した後に再開した時刻をマークするトレース。 アクティビティでトレースを再度出力できます。 トレースの中断/再開は、プロファイリングに便利です。 Resume トレースは、ActivityTracing がトレース ソースで有効な場合に出力されます。|
|![転送](./media/b2d9850e-f362-4ae5-bb8d-9f6f3ca036a5.gif "b2d9850e-f362-4ae5-bb8d-9f6f3ca036a5")|Transfer: 論理制御フローがあるアクティビティから別のアクティビティに転送されるときに出力されるトレース。 転送の発生元のアクティビティは、転送の移動先のアクティビティと並行して作業を続行できます。 Transfer トレースは、ActivityTracing がトレース ソースで有効な場合に出力されます。|
|![転送元](./media/1df215cb-b344-4f36-a20d-195999bda741.gif "1df215cbb344 年3月1日 49 ~ 195999bda741")|Transfer From: 別のアクティビティから現在のアクティビティへの転送を定義するトレース。|
|![転送先](./media/74255b6e-7c47-46ef-8e53-870c76b04c3f.gif "74255b6e-7c47-46ef-8e53-870c76b04c3f")|Transfer To: 現在のアクティビティから別のアクティビティへの論理制御フローの転送を定義するトレース。|

### <a name="wcf-traces"></a>WCF トレース

|アイコン|説明|
|----------|-----------------|
|![メッセージログトレース](./media/7c66e994-2476-4260-a0db-98948b9af197.gif "7c66e994-2476-4260-a0db-98948b9af197")|メッセージログトレース: `System.ServiceModel.MessageLogging` トレースソースが有効になっている場合に、メッセージログ機能によって WCF メッセージがログに記録されるときに生成されるトレース。 このトレースをクリックすると、メッセージが表示されます。 メッセージには、構成可能なログ ポイントが 4 つ (ServiceLevelSendRequest、TransportSend、TransportReceive、および ServiceLevelReceiveRequest) あり、これらは、メッセージ ログ トレースの `messageSource` 属性でも指定できます。|
|![メッセージ受信トレース](./media/de4f586c-c5dd-41ec-b1c3-ac56b4dfa35c.gif "de4f586c-c5dd-41ec-b1c3-ac56b4dfa35c")|Message Received トレース: `System.ServiceModel` トレースソースが情報レベルまたは詳細レベルで有効になっている場合に、WCF メッセージを受信したときに出力されるトレース。 このトレースは、アクティビティ**グラフ**ビューでメッセージの相関矢印を表示するために必要です。|
|![Message Sent トレース](./media/558943c4-17cf-4c12-9405-677e995ac387.gif "55871 3c417cf47 c129405-677e995ac387")|Message Sent トレース: `System.ServiceModel` トレースソースが情報レベルまたは詳細レベルで有効になっている場合に、WCF メッセージが送信されるときに出力されるトレース。 このトレースは、アクティビティ**グラフ**ビューでメッセージの相関矢印を表示するために必要です。|

### <a name="activities"></a>Activities

|アイコン|説明|
|----------|-----------------|
|![アクティビティ](./media/wcfc-defaultactivityc.gif "wcfc_defaultActivityc")|Activity: 現在のアクティビティが一般的なアクティビティであることを示します。|
|![ルート アクティビティ](./media/5dc8e0eb-1c32-4076-8c66-594935beaee9.gif "5dc8e0eb-1c32-4076-8c66-594935beaee9")|Root アクティビティ: プロセスのルート アクティビティを示します。|

### <a name="wcf-activities"></a>WCF アクティビティ

|アイコン|説明|
|----------|-----------------|
|![環境アクティビティ](./media/29fa00ac-cf78-46e5-822d-56222fff61d1.gif "29fa00ac-cf78-46e5-822d-56222fff61d1")|環境アクティビティ: WCF ホストまたはクライアントを作成、オープン、または閉じるアクティビティ。 これらの段階で発生したエラーは、このアクティビティで表示されます。|
|![リッスン アクティビティ](./media/d7b135f6-ec7d-45d7-9913-037ab30e4c26.gif "d7b135f6-ec7d-45d7-9913-037ab30e4c26")|Listen アクティビティ: リスナーに関連するトレースをログに記録するアクティビティ。 このアクティビティ内で、リスナー情報と接続要求を表示できます。|
|![バイトを受信アクティビティ](./media/2f628580-b80f-45a7-925b-616c96426c0e.gif "2f628580-b80f-45a7-925b-616c96426c0e")|Receive Bytes アクティビティ : 2 つのエンドポイント間の接続上で受信バイトに関連するすべてのトレースをグループ化するアクティビティ。 このアクティビティは、http.sys などのアクティビティを伝達する転送アクティビティと相関させる場合に必要です。 中止などの接続エラーが、このアクティビティで表示されます。|
|![メッセージを処理アクティビティ](./media/wcfc-executionactivityiconc.GIF "wcfc_ExecutionActivityIconc")|Process Message アクティビティ: WCF メッセージの作成に関連するトレースをグループ化するアクティビティ。 不正なエンベロープや誤った形式のメッセージが原因のエラーが、このアクティビティで表示されます。 このアクティビティ内で、メッセージ ヘッダーを調べて、アクティビティ ID が呼び出し元から伝達されたかどうかを確認できます。 これが可能であれば、読み出し元と呼び出し先のトレース間を相関するために、Process Action アクティビティ (次のアイコン) に転送するときに、伝達されたアクティビティ ID をそのアクティビティに割り当てることもできます。|
|![メッセージログトレース](./media/7c66e994-2476-4260-a0db-98948b9af197.gif "7c66e994-2476-4260-a0db-98948b9af197")|Process Action アクティビティ: 2 つのエンドポイント間で WCF 要求に関連するすべてのトレースをグループ化するアクティビティ。 両方のエンドポイントの構成で、`propagateActivity` が `true` に設定されている場合は、両方のエンドポイントのすべてのトレースが、直接相関関係を示すために 1 つのアクティビティにマージされます。 このアクティビティは、転送やセキュリティの処理、ユーザー コード境界への拡張、および戻り (応答が存在する場合) で発生するエラーを含みます。|
|![メッセージを処理アクティビティ](./media/wcfc-executionactivityiconc.GIF "wcfc_ExecutionActivityIconc")|Execute User Code アクティビティ: 要求を処理するユーザー コードのトレースをグループ化するアクティビティ。|

## <a name="troubleshooting"></a>トラブルシューティング

レジストリへの書き込みアクセス許可がない場合は、"" コマンドを使用してツールを登録すると、"Microsoft サービストレースビューアーがシステムに登録されていません" というエラーメッセージが表示され `svctraceviewer /register` ます。 このエラーが発生したら、レジストリの書き込みアクセスを持つアカウントを使用してログインする必要があります。

また、サービス トレース ビューアー ツールは、アセンブリ フォルダー内の SvcTraceViewer.exe.settings ファイルに設定 (カスタム フィルターやフィルター オプションなど) を書き込みます。 ファイルの読み取りアクセス許可がない場合、ツールの起動は可能ですが、設定を読み込むことはできません。

.etl ファイルを開くときに、エラー メッセージ "トレースの処理中に不明なエラーが発生しました" が表示される場合は、.etl ファイルの形式が無効であることを示します。

アラビア語のオペレーティング システムを使用して作成されたトレース ログを開く場合に、時間ベースのフィルターが機能しません。 たとえば、2005 年がアラビア カレンダーの 1427 年に対応します。 ただし、サービス トレース ビューアー ツールのフィルターがサポートする時間の範囲は、1752 年より前の日付を含みません。 このことは、フィルターで正しい日付を選択できないことを示します。 この問題を解決するには、特定の時間範囲を含めるための XPath 式を使用して、カスタムフィルター (**ビュー/カスタムフィルター**) を作成します。

## <a name="see-also"></a>関連項目

- [サービス トレース ビューアーを使用した相関トレースの表示とトラブルシューティング](./diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md)
- [トレースの構成](./diagnostics/tracing/configuring-tracing.md)
- [エンドツーエンドのトレース](./diagnostics/tracing/end-to-end-tracing.md)
