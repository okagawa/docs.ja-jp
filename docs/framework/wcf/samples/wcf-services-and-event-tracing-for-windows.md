---
title: WCF サービスと Event Tracing for Windows
ms.date: 03/30/2017
ms.assetid: eda4355d-0bd0-4dc9-80a2-d2c832152272
ms.openlocfilehash: b8a1f30f20aa2c541a574a070b3644569d633ca2
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/12/2020
ms.locfileid: "79183209"
---
# <a name="wcf-services-and-event-tracing-for-windows"></a>WCF サービスと Event Tracing for Windows
このサンプルでは、Windows 通信基盤 (WCF) で分析トレースを使用して、Windows イベント トレース (ETW) でイベントを生成する方法を示します。 分析トレースは、運用環境で WCF サービスのトラブルシューティングを可能にする WCF スタックのキー ポイントで生成されるイベントです。

 WCF サービスの分析トレースは、パフォーマンスへの影響を最小限に抑えて運用環境で有効にできるトレースです。 これらのトレースは、ETW セッションにイベントとして出力されます。

 このサンプルには、イベント ビューアーを使用して表示できるイベント ログに、サービスからイベントが出力される基本的な WCF サービスが含まれています。 WCF サービスからのイベントをリッスンする専用の ETW セッションを開始することもできます。 サンプルには、バイナリ ファイルにイベントを格納する専用の ETW セッションを作成するためのスクリプトが含まれています。このバイナリ ファイルもイベント ビューアーを使用して読み取ることができます。

#### <a name="to-use-this-sample"></a>このサンプルを使用するには

1. 2012 年を使用して、EtwAnalyticTraceSample.sln ソリューション ファイルを開きます。

2. ソリューションをビルドするには、Ctrl キーと Shift キーを押しながら B キーを押します。

3. ソリューションを実行するには、Ctrl キーを押しながら F5 キーを押します。

     Web ブラウザで、[**電卓.svc]** をクリックします。 サービスの WSDL ドキュメントの URI がブラウザーに表示されます。 その URI をコピーします。

     デフォルトでは、サービスはポート 1378`http://localhost:1378/Calculator.svc`で要求のリッスンを開始します。

4. WCF テスト クライアントを実行します。

     WCF テスト クライアント (WcfTestClient.exe)`\<Visual Studio 2012 Install Dir>\Common7\IDE\WcfTestClient.exe`は に配置されています。  既定の Visual Studio 2012`C:\Program Files\Microsoft Visual Studio 10.0`インストール ディレクトリは です。

5. WCF テスト クライアント内で、[**ファイル**] を選択し、[**サービスの追加]** を選択してサービスを追加します。

     入力ボックスにエンドポイントのアドレスを追加します。 既定では、 `http://localhost:1378/Calculator.svc`です。

6. イベント ビューアー アプリケーションを開きます。

     サービスを呼び出す前に、イベント ビューアーを起動し、イベント ログが WCF サービスから生成された追跡イベントをリッスンしていることを確認します。

7. [**スタート**] メニューの [**管理ツール**] をクリックし、[**イベント ビューア**] をクリックします。  **分析**ログと**デバッグ**ログを有効にします。

8. イベント ビューアのツリー ビューで、**イベント ビューア**、**アプリケーションとサービス ログ** **、Microsoft** **、Windows、** および**アプリケーション サーバー アプリケーション**に移動します。 [アプリケーション**サーバー アプリケーション**] を右クリックし、[**表示**] をクリックして、[**分析ログとデバッグ ログの表示**] を選択します。

     [**分析ログとデバッグ ログの表示]** オプションがオンになっていることを確認します。

9. 分析ログを有効**に**します。

     イベント ビューアのツリー ビューで、**イベント ビューア**、**アプリケーションとサービス ログ** **、Microsoft** **、Windows、** および**アプリケーション サーバー アプリケーション**に移動します。 **[分析**] を右クリックし、[**ログの有効化**] を選択します。

#### <a name="to-test-the-service"></a>サービスをテストするには

1. WCF テスト クライアントに切り替えて`Divide`ダブルクリックし、0 の分母を指定する既定値を保持します。

     分母が 0 の場合、サービスからエラーがスローされます。

2. サービスから出力されたイベントを確認します。

     イベント ビューアに戻り、**イベント ビューア**、**アプリケーションとサービス ログ****、Microsoft** **、Windows、** および**アプリケーション サーバー アプリケーション**に移動します。 **[分析**] を右クリックし、[**更新**] を選択します。

     WCF 分析トレースのイベントがイベント ビューアーに表示されます。 サービスからエラーがスローされたため、イベント ビューアーにエラー トレース イベントが表示されていることに注意してください。

3. 手順 1. と 2. を繰り返します。ただし、今度は有効な入力値を指定します。 `N2` パラメーターの値は、0 以外であれば任意の数字でかまいません。

     分析チャネルを更新して、WCF イベントにエラー イベントが含まれていないことを確認します。

 このサンプルでは、WCF サービスから出力される分析トレース イベントを示します。

#### <a name="to-cleanup-optional"></a>クリーンアップするには (省略可能)

1. イベント ビューアーを開きます。

2. イベント**ビューア**、**アプリケーションとサービス ログ** **、Microsoft** **、Windows**、および**アプリケーション サーバー アプリケーション**に移動します。 **[分析**] を右クリックし、[**ログの無効化**] を選択します。

3. イベント**ビューア**、**アプリケーションとサービス ログ** **、Microsoft** **、Windows**、および**アプリケーション サーバー アプリケーション**に移動します。 **[分析**] を右クリックし、[**ログのクリア**] を選択します。

4. イベントを**クリアするには、[クリア]** オプションを選択します。

> [!IMPORTANT]
> サンプルは、既にコンピューターにインストールされている場合があります。 続行する前に、次の (既定の) ディレクトリを確認してください。  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> このディレクトリが存在しない場合は[、.NET Framework 4 の Windows コミュニケーション ファウンデーション (WCF) および Windows ワークフローファウンデーション (WF) サンプル](https://www.microsoft.com/download/details.aspx?id=21459)に移動して、すべての Windows 通信基盤 (WCF) とサンプルを[!INCLUDE[wf1](../../../../includes/wf1-md.md)]ダウンロードします。 このサンプルは、次のディレクトリに格納されます。  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Management\ETWTracing`  
  
## <a name="see-also"></a>関連項目

- [AppFabric の監視のサンプル](https://docs.microsoft.com/previous-versions/appfabric/ff383407(v=azure.10))
