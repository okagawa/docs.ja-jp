---
title: 信頼できるセッションの概要
ms.date: 03/30/2017
ms.assetid: a7fc4146-ee2c-444c-82d4-ef6faffccc2d
ms.openlocfilehash: a85a34c5e2ec7928c01586e4b01cdf5e90e896a7
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84601089"
---
# <a name="reliable-sessions-overview"></a>信頼できるセッションの概要

Windows Communication Foundation (WCF) SOAP reliable messaging は、SOAP エンドポイント間でエンドツーエンドのメッセージ転送の信頼性を提供します。 これにより、信頼性の低いネットワーク上でも、トランスポート エラーや SOAP メッセージ レベルのエラーに対処できます。 具体的には、SOAP またはトランスポート中継局を経由して送信されるメッセージに関して、1 回だけの配信や (オプションで) 順序保証の配信がセッション ベースで提供されます。 セッションベースの配信では、オプションでメッセージの順序を指定して、セッション内のメッセージをグループ化できます。

このトピックでは、信頼できるセッション、それらをいつどのように使用するか、およびそれらをセキュリティで保護する方法について説明します。

## <a name="wcf-reliable-sessions"></a>WCF の信頼できるセッション

WCF reliable sessions は、ws-reliablemessaging プロトコルで定義されている SOAP reliable messaging の実装です。

WCF SOAP reliable messaging は、メッセージングエンドポイントを分離する中継局の数や種類に関係なく、2つのエンドポイント間のエンドツーエンドの信頼できるセッションを提供します。 これには、soap を使用しないトランスポート仲介 (HTTP プロキシなど) や、エンドポイント間のメッセージフローに必要な soap (SOAP ベースのルーターやブリッジなど) を使用する中継局が含まれます。 信頼できるセッションチャネルは、*対話型*通信をサポートしているので、このようなチャネルに接続されているサービスは同時に実行され、待機時間が短い状況 (比較的短い間隔) でメッセージを処理します。 この結合によって、これらのコンポーネントの進行状況がまとめられたり、失敗したりします。そのため、これらのコンポーネント間に分離が提供されることはありません。

信頼できるセッションでは次の 2 種類のエラーがマスクされます。

- SOAP メッセージ レベルのエラー (メッセージの喪失または重複、および送信順序と異なる順序で到着するメッセージを含む)

- トランスポート エラー

信頼できるセッションは、WS-ReliableMessaging プロトコルとメモリ内転送ウィンドウを実装することにより、トランスポート エラーが発生した場合に SOAP メッセージ レベルのエラーをマスクし、接続を再確立します。

信頼できるセッションは、TCP が IP パケットに提供する信頼性を SOAP メッセージに提供します。 TCP ソケット接続では、ノード間で IP パケットが 1 回のみ、正しい順序で転送されます。 信頼できるチャネルでも、これと同じタイプの信頼できる転送が提供されますが、次の点で TCP ソケットの信頼性とは異なります。

- 信頼性は、任意のサイズのバイト パケットに対してではなく、SOAP メッセージ レベルで提供されます。

- 信頼性は、TCP 経由の転送だけでなく、トランスポートに依存しません。

- 信頼性は、特定のトランスポートセッション (たとえば、TCP 接続が提供するセッション) に関連付けられておらず、信頼できるセッションの有効期間にわたって複数のトランスポートセッションを同時に、または順番に使用することができます。

- 信頼できるセッションは、送信側と受信側の SOAP エンドポイント間の接続に必要なトランスポート接続の数に関係なく、両者の間で提供されます。 つまり、TCP の信頼性は、トランスポート接続が終了する場所で終了しますが、信頼できるセッションではエンドツーエンドの信頼性が提供されます。

## <a name="reliable-sessions-and-bindings"></a>信頼できるセッションとバインド

既に説明したように、信頼できるセッションはトランスポートに依存しません。 また、要求/応答や双方向など、多くのメッセージ交換パターンに対して信頼できるセッションを確立することもできます。 WCF の信頼できるセッションは、一連のバインドのプロパティとして公開されます。

次のものを使用するエンドポイントで信頼できるセッションを使用します。

- HTTP ベース トランスポートの標準バインディング

  - `WsHttpBinding` : 要求/応答または一方向のコントラクトを公開します。

  - 要求/応答または単純な一方向のサービスコントラクトに対して信頼できるセッションを使用する場合。

  - `WsDualHttpBinding` : 双方向、要求/応答、または一方向のコントラクトを公開します。

  - `WsFederationHttpBinding` : 要求/応答または一方向のコントラクトを公開します。

- TCP ベース トランスポートの標準バインディング

  - `NetTcpBinding` : 双方向、要求/応答、または一方向のコントラクトを公開します。

HTTPS (問題の詳細については、「<a href="#reliable-sessions-and-security">信頼できるセッションとセキュリティ</a>」を参照) または名前付きパイプバインドを作成して、その他のバインディングで信頼できるセッションを使用します。

信頼できるセッションは、基になるさまざまな種類のチャネルにスタックでき、結果として得られる信頼できるセッションチャネルの形状は異なります。 クライアントとサーバーの両方で、サポートされている信頼できるセッションチャネルの種類は、使用される基になるチャネルの種類によって異なります。 次の表では、基になるチャネルの種類ごとに、クライアントでサポートされるセッション チャネルの種類を示します。

| サポートされている信頼できるセッションチャネルの種類&#8224; | `IRequestChannel` | `IRequestSessionChannel` | `IDuplexChannel` | `IDuplexSessionChannel` |
| ----------------------------------------------- | :---------------: | :----------------------: | :--------------: | :---------------------: |
| `IOutputSessionChannel`                         | はい               | はい                      | はい              | はい                     |
| `IRequestSessionChannel`                        | はい               | はい                      | いいえ               | いいえ                      |
| `IDuplexSessionChannel`                         | いいえ                | いいえ                       | はい              | はい                     |

サポートされているチャネルの種類 &#8224;、 `TChannel` メソッドに渡されるジェネリックパラメーター値に使用できる値です <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.BuildChannelFactory%60%601%28System.ServiceModel.Channels.BindingContext%29> 。

次の表では、基になるチャネルの種類ごとに、サーバーでサポートされるセッション チャネルの種類を示します。

| サポートされている信頼できるセッションチャネルの種類&#8225; | `IReplyChannel` | `IReplySessionChannel` | `IDuplexChannel` | `IDuplexSessionChannel` |
| ----------------------------------------------- | :-------------: | :--------------------: | :--------------: | :---------------------: |
| `IInputSessionChannel`                          | はい             | はい                    | はい              | はい                     |
| `IReplySessionChannel`                          | はい             | はい                    | いいえ               | いいえ                      |
| `IDuplexSessionChannel`                         | いいえ              | いいえ                     | はい              | はい                     |

サポートされているチャネルの種類 &#8225;、 `TChannel` メソッドに渡されるジェネリックパラメーター値に使用できる値です <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.BuildChannelListener%60%601%28System.ServiceModel.Channels.BindingContext%29> 。

## <a name="reliable-sessions-and-security"></a>信頼できるセッションとセキュリティ

信頼できるセッションをセキュリティで保護することは、通信パーティ (サービスとクライアント) が認証され、セッションで交換されるメッセージが改ざんされないようにするために重要です。 さらに、それぞれの信頼できるセッションの整合性を確保することが重要です。 信頼できるセッションは、セキュリティセッションチャネルによって表され、管理されるセキュリティコンテキストにバインドすることによって保護されます。 セキュリティ チャネルによって、セキュリティ セッションが可能になります。 セッション確立中に交換されるセキュリティ トークンは、信頼できるセッションでメッセージをセキュリティで保護するために使用されます。

信頼できるセッションが TCP-S を介している場合、TCP セッションは信頼できるセッションに関連付けられます。 したがって、トランスポートセキュリティにより、セキュリティも信頼できるセッションに関連付けられます。 この場合、接続の再確立は無効になります。

唯一の例外は、HTTPS の使用時です。 Secure Sockets Layer (SSL) セッションが信頼できるセッションにバインドされていません。 これにより、セキュリティコンテキスト (SSL セッション) を共有しているセッションが相互に保護されていないため、脅威が生じます。これは、アプリケーションによっては実際の脅威ではない場合があります。

## <a name="using-reliable-sessions"></a>信頼できるセッションの使用

WCF の信頼できるセッションを使用するには、信頼できるセッションをサポートするバインディングを使用してエンドポイントを作成します。 WCF によって提供される、信頼できるセッションが有効になっているシステム指定のバインディングの1つを使用するか、これを行う独自のカスタムバインドを作成します。

信頼できるセッションが既定でサポートおよび有効化されているシステム定義のバインディングは、次のとおりです。

- <xref:System.ServiceModel.WSDualHttpBinding>

オプションとして信頼できるセッションをサポートするが、既定では有効にしないシステム指定のバインディングには、次のものがあります。

- <xref:System.ServiceModel.WSHttpBinding>

- <xref:System.ServiceModel.WSFederationHttpBinding>

- <xref:System.ServiceModel.NetTcpBinding>

カスタムバインディングを作成する方法の例については、「[方法: HTTPS を使用してカスタムの信頼できるセッションのバインディングを作成](how-to-create-a-custom-reliable-session-binding-with-https.md)する」を参照してください。

信頼できるセッションをサポートする WCF バインディングの詳細については、「[システム指定のバインディング](../system-provided-bindings.md)」を参照してください。

## <a name="when-to-use-reliable-sessions"></a>信頼できるセッションを使用する場合

アプリケーションで信頼できるセッションを使用するタイミングを理解することが重要です。 WCF は、アクティブなエンドポイントとアクティブなエンドポイント間の信頼できるセッションをサポートします。 アプリケーションでエンドポイントのいずれかが使用できなくなることが必要な場合は、キューを使用して信頼性を確保します。

このシナリオで2つのエンドポイントが TCP 経由で接続されている必要がある場合、信頼性の高いメッセージ交換を実現するために TCP が十分である可能性があります ただし、TCP ではパケットが順番に受信され、1回だけ到着することが保証されるため、信頼できるセッションを使用する必要はありません。

シナリオに次のいずれかの特性がある場合は、信頼できるセッションの使用を真剣に検討する必要があります。

- Soap ルーターなどの SOAP 中継局

- プロキシ中継局またはトランスポートブリッジ

- 断続的な接続

- HTTP 経由のセッション

## <a name="see-also"></a>関連項目

- [サービスとクライアントを構成するためのバインディングの使用](../using-bindings-to-configure-services-and-clients.md)
- [WS 信頼できるセッション](../samples/ws-reliable-session.md)
