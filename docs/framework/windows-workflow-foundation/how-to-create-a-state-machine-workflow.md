---
title: '方法: ステート マシン ワークフローを作成する'
description: この記事では、StateMachine アクティビティなどの組み込みアクティビティとカスタムアクティビティの両方を使用するワークフローを作成します。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 3ec60e8f-fad4-493e-a426-e7962d7aee8c
ms.openlocfilehash: 8a9342c07c15d65df0310c0cb35b4b2c6f2ba686
ms.sourcegitcommit: 9a4488a3625866335e83a20da5e9c5286b1f034c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/15/2020
ms.locfileid: "83419656"
---
# <a name="how-to-create-a-state-machine-workflow"></a>方法: ステート マシン ワークフローを作成する
ワークフローは、ビルトイン アクティビティおよびカスタム アクティビティから構築できます。 このトピックでは、アクティビティなどの組み込みのアクティビティ <xref:System.Activities.Statements.StateMachine> と、前の「 [How To: Create a activity](how-to-create-an-activity.md) 」のカスタムアクティビティの両方を使用するワークフローを作成する手順について説明します。 このワークフローは、数値推測ゲームをモデル化しています。  
  
> [!NOTE]
> チュートリアル入門の各トピックは、前のトピックに応じて異なります。 このトピックを完了するには、まず「[方法: アクティビティを作成](how-to-create-an-activity.md)する」を完了する必要があります。  
  
> [!NOTE]
> チュートリアルの完成版をダウンロードするには、「 [Windows Workflow Foundation (WF45) - Getting Started Tutorial (Windows Workflow Foundation (WF45) - チュートリアル入門)](https://go.microsoft.com/fwlink/?LinkID=248976)」を参照してください。  
  
### <a name="to-create-the-workflow"></a>ワークフローを作成するには  
  
1. **ソリューションエクスプローラー**で [ **NumberGuessWorkflowActivities** ] を右クリックし、[**追加**]、[**新しい項目**] の順に選択します。  
  
2. [**インストール済み**] の [**共通項目**] ノードで、[**ワークフロー**] を選択します。 [**ワークフロー**] 一覧から [**アクティビティ**] を選択します。  
  
3. `StateMachineNumberGuessWorkflow`[**名前**] ボックスに「」と入力し、[**追加**] をクリックします。  
  
4. **ツールボックス**の [**ステートマシン**] セクションから**StateMachine**アクティビティをドラッグし、ワークフローデザインサーフェイスの [**ここにアクティビティをドロップ**] ラベルにドロップします。  
  
### <a name="to-create-the-workflow-variables-and-arguments"></a>ワークフロー変数および引数を作成するには  
  
1. **ソリューションエクスプローラー**で**statemachinenumberguessworkflow.xaml**をダブルクリックして、ワークフローをデザイナーに表示します (まだ表示されていない場合)。  
  
2. ワークフローデザイナーの左下にある [**引数**] をクリックして、[**引数**] ペインを表示します。  
  
3. [**Create Argument**] (引数の作成) をクリックします。  
  
4. [名前] ボックスに「」と入力し、[ `MaxNumber` **方向**] ドロップダウンリストから [ **In** ] を選択します。次に、[**引数の型**] ドロップダウンリストから [ **Int32** ] を選択し、enter キーを押して引数を保存します。 **Name**  
  
5. [**Create Argument**] (引数の作成) をクリックします。  
  
6. `Turns`新しく追加された引数の下にある [**名前**] ボックスに「」と入力し、 `MaxNumber` [**方向**] ドロップダウンリストから [ **Out** ] を選択します。次に、[**引数の型**] ドロップダウンリストから [ **Int32** ] を選択し、enter キーを押します。  
  
7. アクティビティ デザイナーの左下にある [**引数**] をクリックして、[**引数**] ウィンドウを閉じます。  
  
8. ワークフローデザイナーの左下にある [**変数**] をクリックして、[**変数**] ペインを表示します。  
  
9. [**変数の作成**] をクリックします。  
  
    > [!TIP]
    > [**変数の作成**] ボックスが表示されない場合は、 <xref:System.Activities.Statements.StateMachine> ワークフローデザイナー画面でアクティビティをクリックして選択します。  
  
10. [ `Guess` **名前**] ボックスに「」と入力し、[**変数の型**] ドロップダウンリストから [ **Int32** ] を選択します。次に、enter キーを押して変数を保存します。  
  
11. [**変数の作成**] をクリックします。  
  
12. [ `Target` **名前**] ボックスに「」と入力し、[**変数の型**] ドロップダウンリストから [ **Int32** ] を選択します。次に、enter キーを押して変数を保存します。  
  
13. アクティビティ デザイナーの左下にある [**変数**] をクリックして、[**変数**] ウィンドウを閉じます。  
  
### <a name="to-add-the-workflow-activities"></a>ワークフロー アクティビティを追加するには  
  
1. [ **State1** ] をクリックして選択します。 [**プロパティ] ウィンドウ**で、 **DisplayName**をに変更し `Initialize Target` ます。  
  
    > [!TIP]
    > [**プロパティ] ウィンドウ**が表示されていない場合は、[**表示**] メニューの [**プロパティウィンドウ**] をクリックします。  
  
2. ワークフローデザイナーで、新しく名前を変更した [**初期化のターゲット**] 状態をダブルクリックして展開します。  
  
3. **ツールボックス**の [**プリミティブ**] セクションから**Assign**アクティビティをドラッグし、状態の**Entry**セクションにドロップします。 [ `Target` **To** ] ボックスに「」と入力し、[ **C# の式を入力**するか、VB の式を**入力**してください] ボックスに次の式を入力します。  
  
    ```vb  
    New System.Random().Next(1, MaxNumber + 1)  
    ```  
  
    ```csharp  
    new System.Random().Next(1, MaxNumber + 1)  
    ```  
  
    > [!TIP]
    > [**ツールパレット**] ウィンドウが表示されていない場合は、[**表示**] メニューから [**ツールパレット**] を選択します。  
  
4. ワークフローデザイナーの上部にある階層リンク表示で [ **StateMachine** ] をクリックして、ワークフローデザイナーの全体的なステートマシンビューに戻ります。  
  
5. **ツールボックス**の [**ステートマシン**] セクションから**state**アクティビティをワークフローデザイナーにドラッグし、[ **Initialize Target** ] 状態の上に置きます。 新しい状態がその上にあると、4つの三角形が**Initialize ターゲット**状態の周囲に表示されることに注意してください。 **Initialize ターゲット**状態のすぐ下にある三角形に新しい状態をドロップします。 これにより、新しい状態がワークフローに配置され、 **Initialize ターゲット**状態から新しい状態への遷移が作成されます。  
  
6. [ **State1** ] をクリックして選択し、 **DisplayName**をに変更し `Enter Guess` ます。次に、ワークフローデザイナーで状態をダブルクリックして展開します。  
  
7. **ツールボックス**の [**プリミティブ**] セクションから**WriteLine**アクティビティをドラッグし、状態の**Entry**セクションにドロップします。  
  
8. **WriteLine**の [ **Text** ] プロパティボックスに次の式を入力します。  
  
    ```vb  
    "Please enter a number between 1 and " & MaxNumber  
    ```  
  
    ```csharp  
    "Please enter a number between 1 and " + MaxNumber  
    ```  
  
9. [**ツールボックス**] の [**プリミティブ**] セクションから**Assign**アクティビティをドラッグし、状態の [**終了**] セクションにドロップします。  
  
10. [ `Turns` **To** ] ボックスに「」と入力し、[C# の式を入力するか、VB の式を入力してください `Turns + 1` ] ボックスに入力します**Enter a C# expression** 。 **Enter a VB expression**  
  
11. ワークフローデザイナーの上部にある階層リンク表示で [ **StateMachine** ] をクリックして、ワークフローデザイナーの全体的なステートマシンビューに戻ります。  
  
12. **ツールボックス**の [**ステートマシン**] セクションから**finalstate**アクティビティをドラッグし、 **enter guess**状態の上にマウスポインターを移動して **、enter guess 状態の**右側に表示される三角形にドロップします。これにより、 **enter guess**と**finalstate**の間に遷移が作成されます。  
  
13. 遷移の既定の名前は**T2**です。 ワークフローデザイナーで遷移をクリックして選択し、その**DisplayName**を [**正しい推測**] に設定します。 次に、[ **Finalstate**] をクリックして選択し、右側にドラッグして、2つの状態のいずれかをオーバーレイせずに完全な遷移名を表示できるようにします。 これにより、チュートリアルの残りの手順をより簡単に実行できます。  
  
14. ワークフローデザイナーで、新しく名前を変更した [**推測**] をダブルクリックして展開します。  
  
15. [**ツールボックス**] の [ **NumberGuessWorkflowActivities** ] セクションから**readint**アクティビティをドラッグし、遷移の [**トリガー** ] セクションにドロップします。  
  
16. **Readint**アクティビティの [**プロパティ] ウィンドウ**で、[ `"EnterGuess"` **BookmarkName** ] プロパティ値ボックスに引用符を含めて「」と入力し、 `Guess` **結果**のプロパティ値ボックスに「」と入力します。  
  
17. [**正しい**移行の**条件**] プロパティ値ボックスに次の式を入力します。  
  
    ```vb  
    Guess = Target  
    ```  
  
    ```csharp  
    Guess == Target  
    ```  
  
18. ワークフローデザイナーの上部にある階層リンク表示で [ **StateMachine** ] をクリックして、ワークフローデザイナーの全体的なステートマシンビューに戻ります。  
  
    > [!NOTE]
    > トリガー イベントが受け取られ、<xref:System.Activities.Statements.Transition.Condition%2A> (存在する場合) が `True` と評価される場合に遷移が発生します。 この遷移では、ユーザーのが `Guess` ランダムに生成されたと一致 `Target` すると、制御が**finalstate**に渡され、ワークフローが完了します。  
  
19. 推定値が正しいかどうかに応じて、ワークフローは、 **Finalstate**に遷移するか、別の try に対し**て Enter guess**状態に戻す必要があります。 両方の遷移は、 **Readint**アクティビティを使用してユーザーの推定値を受け取ることを待機しているのと同じトリガーを共有します。 これは、共有遷移と呼ばれます。 共有遷移を作成するには、**推測の正しい**切り替え効果の開始を示す円をクリックし、目的の状態にドラッグします。 この場合、切り替え効果は自己遷移型であるため、**推測**の開始点をドラッグして、 **Enter Guess**状態の下にドロップします。 遷移を作成した後、ワークフローデザイナーでそれを選択し、その**DisplayName**プロパティを「**正しくない推測**」に設定します。  
  
    > [!NOTE]
    > 切り替え効果は、切り替え効果デザイナーの下部にある [**共有トリガー遷移の追加**] をクリックして、[**接続可能な状態**] ボックスから目的のターゲット状態を選択することによっても作成できます。  
  
    > [!NOTE]
    > 遷移の <xref:System.Activities.Statements.Transition.Condition%2A> が `false` と評価された場合 (またはトリガーを共有する遷移すべての状態が `false` と評価された場合)、遷移は行われず、その状態からのすべての遷移のすべてのトリガーが再スケジュールされます。 このチュートリアルでは、条件の構成方法 (推定値が正しいか間違っているかを判断する特定のアクションが用意されています) により、この状況は発生しません。  
  
20. ワークフローデザイナーで [**推測**されない] をダブルクリックして展開します。 **トリガー**は、**推定の正しい**切り替えによって使用されたのと同じ**readint**アクティビティに既に設定されていることに注意してください。  
  
21. [**条件**] プロパティ値ボックスに次の式を入力します。  
  
    ```vb  
    Guess <> Target  
    ```  
  
    ```csharp  
    Guess != Target  
    ```  
  
22. [**ツールボックス**] の [**制御フロー** ] セクションから**If**アクティビティをドラッグし、遷移の [**アクション**] セクションにドロップします。  
  
23. **If**アクティビティの [ **Condition** ] プロパティ値ボックスに次の式を入力します。  
  
    ```text
    Guess < Target
    ```  
  
24. **ツールボックス**の [**プリミティブ**] セクションから2つの**WriteLine**アクティビティをドラッグし、 **if**アクティビティの**Then**セクション、1が**Else**セクションにあるようにドロップします。  
  
25. **[Then** ] セクションで [ **WriteLine** ] アクティビティをクリックして選択し、[ **Text** ] プロパティ値ボックスに次の式を入力します。  
  
    ```text
    "Your guess is too low."  
    ```  
  
26. [ **Else** ] セクションの**WriteLine**アクティビティをクリックして選択し、[ **Text** ] プロパティ値ボックスに次の式を入力します。  
  
    ```text
    "Your guess is too high."  
    ```  
  
27. ワークフローデザイナーの上部にある階層リンク表示で [ **StateMachine** ] をクリックして、ワークフローデザイナーの全体的なステートマシンビューに戻ります。  
  
     次の例は完成したワークフローを示しています。  
  
     ![完成したステートマシンのワークフローを示す図。](./media/how-to-create-a-state-machine-workflow/complete-state-machine-workflow.jpg)  
  
### <a name="to-build-the-workflow"></a>ワークフローをビルドするには  
  
1. Ctrl + Shift + B キーを押して、ソリューションをビルドします。  
  
     ワークフローを実行する方法については、次のトピック「[方法: ワークフローを実行](how-to-run-a-workflow.md)する」を参照してください。 [「方法:](how-to-run-a-workflow.md)ワークフローステップを別のスタイルのワークフローで実行し、この手順のステートマシンワークフローを使用して実行する場合は、「 [How to: run a workflow](how-to-run-a-workflow.md)」の「[アプリケーションをビルドして実行するに](how-to-run-a-workflow.md#BKMK_ToRunTheApplication)は」に進んでください。  
  
## <a name="see-also"></a>関連項目

- <xref:System.Activities.Statements.Flowchart>
- <xref:System.Activities.Statements.FlowDecision>
- [Windows Workflow Foundation プログラミングの新機能](programming.md)
- [ワークフローの設計](designing-workflows.md)
- [はじめにチュートリアル](getting-started-tutorial.md)
- [方法: アクティビティを作成する](how-to-create-an-activity.md)
- [方法: ワークフローを実行する](how-to-run-a-workflow.md)
