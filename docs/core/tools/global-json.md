---
title: global.json の概要
description: .NET Core CLI コマンドを実行するときに global.json ファイルを使用して .NET Core SDK のバージョンを設定する方法について説明します。
ms.date: 05/01/2020
ms.custom: updateeachrelease
ms.openlocfilehash: 5078bc03056c23bccf02e027441de72c69072c7d
ms.sourcegitcommit: 71b8f5a2108a0f1a4ef1d8d75c5b3e129ec5ca1e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/29/2020
ms.locfileid: "84202027"
---
# <a name="globaljson-overview"></a>global.json の概要

**この記事の対象:** ✔️ .NET Core 2.0 SDK 以降のバージョン

*global.json* ファイルを使うと、.NET Core CLI コマンドを実行するときに使う .NET Core SDK のバージョンを定義できます。 .NET Core SDK の選択は、プロジェクトのターゲットであるランタイムの指定とは関係ありません。 .NET Core SDK のバージョンは、使われている .NET Core CLI のバージョンを示します。

通常は、最新バージョンの SDK ツールを使うので、*global.json* ファイルは必要ありません。 一部の高度なシナリオでは、SDK ツールのバージョンを管理する必要がある場合があります。この記事では、この方法について説明します。

代わりにランタイムを指定する方法について詳しくは、「[ターゲット フレームワーク](../../standard/frameworks.md)」をご覧ください。

.NET Core SDK は、現在の作業ディレクトリ (プロジェクト ディレクトリと同じではない場合があります) 内、またはその親ディレクトリのいずれかで、*global.json* ファイルを探します。

## <a name="globaljson-schema"></a>global.json のスキーマ

### <a name="sdk"></a>SDK

型: `object`

選択する .NET Core SDK についての情報を指定します。

#### <a name="version"></a>version

- 型: `string`

- .NET Core 1.0 SDK 以降で利用できます。

使用する .NET Core SDK のバージョンです。

このフィールドでは:

- ワイルドカードはサポートされていません。つまり、完全なバージョン番号を指定する必要があります。
- バージョン範囲はサポートされていません。

#### <a name="allowprerelease"></a>allowPrerelease

- 型: `boolean`

- .NET Core 3.0 SDK 以降で利用できます。

使用する SDK バージョンを選択するときに、SDK リゾルバーでプレリリース バージョンを考慮する必要があるかどうかを示します。

この値を明示的に設定しない場合、Visual Studio から実行しているかどうかによって既定値が決まります。

- Visual Studio を使用して**いない**場合、既定値は `true` になります。
- Visual Studio を使用している場合は、要求されたプレリリース状態が使用されます。 つまり、Visual Studio のプレビュー バージョンを使用している場合、または ( **[ツール]**  >  **[オプション]**  >  **[環境]**  >  **[プレビュー機能]** で) **[.NET Core SDK のプレビューを使用する]** オプションを設定している場合、既定値は `true` で、それ以外の場合は、`false` です。

#### <a name="rollforward"></a>rollForward

- 型: `string`

- .NET Core 3.0 SDK 以降で利用できます。

SDK バージョンを選択するときに、特定の SDK バージョンがない場合のフォールバックとして、またはより新しいバージョンを使用するためのディレクティブとして使用するロールフォワード ポリシー。 [バージョン](#version) は、`latestMajor` に設定する場合を除き、`rollForward` 値を使用して指定する必要があります。

使用可能なポリシーとその動作を理解するには、`x.y.znn` の形式で SDK バージョンの次の定義を考慮してください。

- `x` はメジャー バージョンです。
- `y` はマイナー バージョンです。
- `z` は機能帯です。
- `nn` はパッチ バージョンです。

`rollForward` キーの有効値を次の表に示します。

| [値]         | 動作 |
| ------------- | ---------- |
| `patch`       | 指定されたバージョンを使用します。 <br> 見つからない場合は、最新のパッチ レベルにロールフォワードします。 <br> 見つからない場合は、失敗します。 <br><br> この値は、以前のバージョンの SDK の従来の動作です。 |
| `feature`     | 指定されたメジャー、マイナー、および機能帯に対して最新のパッチ レベルを使用します。 <br> 見つからない場合は、同じメジャーまたはマイナー内の次の上位の機能帯にロールフォワードし、その機能帯に最新のパッチ レベルを使用します。 <br> 見つからない場合は、失敗します。 |
| `minor`       | 指定されたメジャー、マイナー、および機能帯に対して最新のパッチ レベルを使用します。 <br> 見つからない場合は、同じメジャー バージョンまたはマイナー バージョン内の次の上位の機能帯にロールフォワードし、その機能帯に最新のパッチ レベルを使用します。 <br> 見つからない場合は、同じメジャー内の次の上位のマイナーおよび機能帯にロールフォワードし、その機能帯に最新のパッチ レベルを使用します。 <br> 見つからない場合は、失敗します。 |
| `major`       | 指定されたメジャー、マイナー、および機能帯に対して最新のパッチ レベルを使用します。 <br> 見つからない場合は、同じメジャー バージョンまたはマイナー バージョン内の次の上位の機能帯にロールフォワードし、その機能帯に最新のパッチ レベルを使用します。 <br> 見つからない場合は、同じメジャー内の次の上位のマイナーおよび機能帯にロールフォワードし、その機能帯に最新のパッチ レベルを使用します。 <br> 見つからない場合は、次の上位のメジャー、マイナー、機能帯にロールフォワードし、その機能帯に最新のパッチ レベルを使用します。 <br> 見つからない場合は、失敗します。 |
| `latestPatch` | 要求されたメジャー、マイナー、および機能帯が、指定された値以上のパッチ レベルと一致する、インストールされている最新のパッチ レベルを使用します。 <br> 見つからない場合は、失敗します。 |
| `latestFeature` | 要求されたメジャーとマイナーが、指定された値以上の機能帯と一致する、インストールされている最上位の機能帯を使用します。 <br> 見つからない場合は、失敗します。 |
| `latestMinor` | 要求されたメジャーが指定された値以上のマイナーと一致する、インストールされている最上位のマイナー、機能帯、パッチ レベルを使用します。 <br> 見つからない場合は、失敗します。 |
| `latestMajor` | インストールされている最上位の .NET Core SDK と、指定した値以上のメジャーを使用します。 <br> 見つからない場合は、失敗します。 |
| `disable`     | ロールフォワードしません。 完全一致が必要です。 |

### <a name="msbuild-sdks"></a>msbuild-sdks

型: `object`

個々のプロジェクトではなく、1 か所でプロジェクト SDK バージョンを管理できます。 詳細については、「[プロジェクト SDK の解決方法](/visualstudio/msbuild/how-to-use-project-sdk#how-project-sdks-are-resolved)」を参照してください。

## <a name="examples"></a>使用例

次の例は、プレリリース バージョンを使用しない方法を示しています。

```json
{
  "sdk": {
    "allowPrerelease": false
  }
}
```

次の例は、指定したバージョン以上の、インストールされている最新バージョンを使用する方法を示しています。 この JSON では、2.2.200 より前の SDK バージョンがすべて禁止され、3.0.xxx や 3.1.xxx など、2.2.200 以降のバージョンがすべて許可されます。

```json
{
  "sdk": {
    "version": "2.2.200",
    "rollForward": "latestMajor"
  }
}
```

次の例は、指定された正確なバージョンを使用する方法を示しています。

```json
{
  "sdk": {
    "version": "3.1.100",
    "rollForward": "disable"
  }
}
```

次の例では、特定のメジャー バージョンとマイナー バージョンでインストールされる最新の機能バンドと修正プログラムのバージョンを使用する方法を示します。 この JSON では、3.1.102 より前の SDK バージョンがすべて禁止され、3.1.103 や 3.1.200 など、3.1.102 とそれ以降の 3.1.xxx バージョンがすべて許可されます。

```json
{
  "sdk": {
    "version": "3.1.102",
    "rollForward": "latestFeature"
  }
}
```

次の例は、特定のバージョンのインストールされている最新のパッチ バージョンを使用する方法を示しています。 この JSON では、3.1.102 より前の SDK バージョンがすべて禁止され、3.1.103 や 3.1.199 など、3.1.102 とそれ以降の 3.1.1xx バージョンがすべて許可されます。

```json
{
  "sdk": {
    "version": "3.1.102",
    "rollForward": "latestPatch"
  }
}
```

## <a name="globaljson-and-the-net-core-cli"></a>global.json と .NET Core CLI

ご使用のマシンにインストールされている SDK のバージョンを把握しておくと、*global.json* ファイルにそれを設定するときに役立ちます。 その方法の詳細については、[.NET Core が既にインストールされていることを確認する方法](../install/how-to-detect-installed-versions.md#check-sdk-versions)に関するセクションを参照してください。

.NET Core SDK の別のバージョンをコンピューターにインストールするには、[.NET Core のダウンロード](https://dotnet.microsoft.com/download/dotnet-core) ページにアクセスしてください。

次の例のような [dotnet new](dotnet-new.md) コマンドを実行することにより、新しい *global.json* ファイルを現在のディレクトリに作成できます。

```dotnetcli
dotnet new globaljson --sdk-version 3.0.100
```

## <a name="matching-rules"></a>照合ルール

> [!NOTE]
> 照合ルールは、すべてのインストール済み .NET Core のインストール済みランタイムで共通の `dotnet.exe` エントリ ポイントによって管理されます。 .NET Core ランタイムのインストール済みの最新バージョンの照合ルールは、複数のランタイムがサイドバイサイドでインストールされている場合に使用されます。

## <a name="net-core-3x"></a>[.NET Core 3.x](#tab/netcore3x)

.NET Core 3.0 以降では、使用する SDK のバージョンを決定するときに次のルールが適用されます。

- *global.json* ファイルが見つからない場合、または *global.json* で SDK のバージョンまたは `allowPrerelease` 値が指定されていない場合は、インストールされている最新バージョンの SDK が使用されます (`rollForward` を `latestMajor` に設定するのと同じ)。 プレリリース SDK のバージョンを考慮するかどうかは、`dotnet` の呼び出し方法によって決まります。
  - Visual Studio を使用して**いない**場合は、プレリリース バージョンが考慮されます。
  - Visual Studio を使用している場合は、要求されたプレリリース状態が使用されます。 つまり、Visual Studio のプレビュー バージョンを使用している場合、または ( **[ツール]**  >  **[オプション]**  >  **[環境]**  >  **[プレビュー機能]** で) **[.NET Core SDK のプレビューを使用する]** オプションを設定している場合、プレリリース バージョンが考慮され、それ以外の場合は、リリース バージョンのみが考慮されます。
- SDK のバージョンは指定していないが `allowPrerelease` 値を指定している *global.json* ファイルが見つかった場合は、インストールされている最新の SDK バージョンが使用されます (`rollForward` を `latestMajor` に設定するのと同じ)。 最新の SDK バージョンをリリースまたはプレリリースにできるかどうかは、`allowPrerelease` の値によって決まります。 `true` は、プレリリースバージョンが考慮されることを示し、`false` は、リリース バージョンのみが考慮されることを示します。
- *global.json* ファイルが見つかり、そこで SDK バージョンが指定されている場合は、次のようになります。

  - `rollFoward` 値が設定されていない場合、`latestPatch` が既定の `rollForward` ポリシーとして使用されます。 それ以外の場合は、「[rollForward](#rollforward)」セクションで各値とその動作を確認します。
  - 「[allowPrerelease](#allowprerelease)」セクションには、プレリリース バージョンが考慮されるかどうか、`allowPrerelease` が設定されていない場合の既定の動作についての説明があります。

## <a name="net-core-2x"></a>[.NET Core 2.x](#tab/netcore2x)

.NET Core 2.x SDK では、使用する SDK のバージョンを決定するときに次のルールが適用されます。

- *global.json* ファイルが見つからない場合、または *global.json* で SDK のバージョンが指定されていない場合は、インストールされている最新バージョンの SDK が使用されます。 SDK の最新バージョンはリリースまたはプレリリースのどちらでもよく、最も高いバージョン番号が採用されます。
- *global.json* で SDK のバージョンが指定されている場合:
  - 指定されている SDK のバージョンがコンピューターで見つかった場合は、その厳密なバージョンが使用されます。
  - 指定されている SDK のバージョンがコンピューターで見つからない場合は、そのバージョンの SDK の**パッチ バージョン**でインストールされている最新のものが使用されます。 インストールされている最新の SDK **パッチ バージョン**は、リリースまたはプレリリースのどちらでもよく、最も高いバージョン番号が採用されます。 .NET Core 2.1 以降では、指定されている**パッチ バージョン**より低い**パッチ バージョン**は、SDK の選択で無視されます。
  - 指定されたバージョンの SDK および適切な SDK **パッチ バージョン**が見つからない場合は、エラーがスローされます。

SDK のバージョンは次の部分で構成されます。

`[.NET Core major version].[.NET Core minor version].[xyz][-optional preview name]`

SDK バージョン 2.1.100 以降の番号の最後の部分 (`xyz`) の最初の桁 (`x`) は、.NET Core SDK の**機能リリース**を表します。 一般に、リリース サイクルは .NET Core より .NET Core SDK の方が速くなります。

**パッチ バージョン**は、SDK バージョン 2.1.100 以降の番号の最後の部分 (`xyz`) の最後の 2 桁 (`yz`) で定義されます。 たとえば、SDK のバージョンとして `2.1.300` を指定した場合、SDK の選択では `2.1.399` まで検索されますが、`2.1.400` は `2.1.300` のパッチ バージョンとして考慮されません。

.NET Core SDK のバージョン `2.1.100` から `2.1.201` までは、バージョン番号体系の移行の間にリリースされたため、`xyz` の表記を正しく処理していません。 *global.json* ファイルでこれらのバージョンを指定する場合は、指定するバージョンがターゲット コンピューター上にあることを確認するよう強くお勧めします。

---

## <a name="troubleshoot-build-warnings"></a>ビルドの警告のトラブルシューティング

* 次の警告は、プロジェクトがプレリリース バージョンの .NET Core SDK を使用してコンパイルされたことを示しています。

  > .NET Core SDK のプレビュー バージョンを使用しています。 現在のプロジェクトの global.json ファイルを使用して、SDK のバージョンを定義できます。 詳しくは <https://go.microsoft.com/fwlink/?linkid=869452> を参照してください。

  .NET Core SDK のバージョンには高品質の履歴とコミットメントがあります。 ただし、プレリリース バージョンを使用しない場合は、「[allowPrerelease](#allowprerelease)」セクションで、.NET Core 3.0 SDK 以降のバージョンで使用できるさまざまな方法を確認してください。 .NET Core 3.0 以降のランタイムまたは SDK がインストールされていないマシンの場合は、*global.json* ファイルを作成し、使用する正確なバージョンを指定する必要があります。

* 次の警告は、プロジェクトのターゲットが EF Core 1.0 または 1.1 であり、.NET Core 2.1 SDK 以降のバージョンと互換性がないことを示します。

  > スタートアップ プロジェクト '{startupProject}' で、フレームワーク '.NETCoreApp' バージョン '{targetFrameworkVersion}' がターゲットになっています。このバージョンの Entity Framework Core .NET コマンド ライン ツールは、バージョン 2.0 以降のみをサポートします。 古いバージョンのツールの使用については、<https://go.microsoft.com/fwlink/?linkid=871254> をご覧ください。

  .NET Core 2.1 SDK (バージョン 2.1.300) 以降で、`dotnet ef` コマンドは SDK に含まれています。 プロジェクトをコンパイルするには、.NET Core 2.0 SDK (バージョン 2.1.201) またはそれ以前のバージョンをご利用のコンピューター上にインストールし、*global.json* ファイルを使用して必要な SDK バージョンを定義します。 `dotnet ef` コマンドの詳細については、「[EF Core .NET コマンドライン ツール](/ef/core/miscellaneous/cli/dotnet)」を参照してください。

## <a name="see-also"></a>関連項目

- [プロジェクト SDK の解決方法](/visualstudio/msbuild/how-to-use-project-sdk#how-project-sdks-are-resolved)
