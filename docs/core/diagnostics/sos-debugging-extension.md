---
title: .NET 用 SOS デバッガー拡張
description: 内部 CLR 環境に関する情報を提供する、.NET 用の SOS デバッガー拡張について学習します。
ms.date: 12/21/2020
helpviewer_keywords:
- debugging extensions
- SOS debugging extensions
- SOS.dll
ms.openlocfilehash: a24b946c4ffda59e17f61c065d2846dc1a6effe0
ms.sourcegitcommit: c0b803bffaf101e12f071faf94ca21b46d04ff30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/24/2020
ms.locfileid: "97764969"
---
# <a name="sos-debugging-extension"></a>SOS デバッガー拡張

SOS デバッガー拡張を使用すると、ライブ プロセスとダンプの両方で、.NET Core ランタイム内で実行されているコードに関する情報を表示できます。 この拡張機能は [dotnet](dotnet-dump.md) および [Windbg/dbg](/windows-hardware/drivers/debugger/debugger-download-tools) と共にプレインストールされており、LLDB で使用するために[ダウンロード](dotnet-sos.md)できます。  SOS デバッガー拡張は、マネージド ヒープに関する情報の収集、ヒープ破損の検索、ランタイムで使用される内部データ型の表示、およびランタイム内で実行されるすべてのマネージド コードに関する情報の表示に役立ちます。

## <a name="syntax"></a>構文

### <a name="windows"></a>Windows

`![command] [options]`

### <a name="linux-and-macos"></a>Linux と macOS

`sos [command] [options]`

コマンドの多くには、lldb の下に別名またはショートカットがあります。

`clrstack [options]`

## <a name="commands"></a>コマンド

以下のコマンドの表は、**Help** または **soshelp** でも使用できます。  `soshelp <command>` を使って、個々のコマンド ヘルプを使用できます。

|コマンド|説明|
|-------------|-----------------|
|**bpmd** **[-nofuturemodule]** [\<*module name*> \<*method name*>] [ **-md** <`MethodDesc`>] **-list** **-clear** \<*pending breakpoint number*> **-clearall**|指定したモジュールの指定したメソッドにブレークポイントを作成します。<br /><br /> 指定したモジュールとメソッドが読み込まれていない場合、このコマンドは、モジュールが読み込まれ、Just-In-Time (JIT) コンパイルが終了したことを示す通知を受け取るまで待機してから、ブレークポイントを作成します。<br /><br /> **-list**、 **-clear**、および **-clearall** の各オプションを使用して、保留中のブレークポイントのリストを管理できます。<br /><br /> **-list** オプションは、保留中のすべてのブレークポイントのリストを生成します。 保留中のブレークポイントにゼロ以外のモジュール ID がある場合、そのブレークポイントはその特定の読み込まれたモジュール内の関数に対するブレークポイントです。 保留中のブレークポイントにゼロのモジュール ID がある場合、そのブレークポイントはまだ読み込まれていないモジュールに適用されます。<br /><br /> 保留中のブレークポイントをリストから削除するには、 **-clear** オプションまたは **-clearall** オプションを使用します。|
|**CLRStack** **[-a]** **[-l]** **[-p]** **[-n]** **[-f]** **[-r]** **[-all]**|マネージド コードのみのスタック トレースを提供します。<br /><br /> **-p** オプションは、マネージド関数に渡す引数を表示します。<br /><br /> **-l** オプションは、フレーム内のローカル変数に関する情報を表示します。 SOS デバッグ拡張機能ではローカル名を取得できないため、ローカル名の出力は \<*local address*> **=** \<*value*> の形式になります。<br /><br /> **-a** オプションは、 **-l** と **-p** の組み合わせのショートカットです。<br /><br /> **-n** オプションを指定すると、ソース ファイル名と行番号の表示が無効になります。 デバッガーで SYMOPT_LOAD_LINES オプションが指定されている場合、SOS はすべてのマネージド フレームでシンボルを検索し、成功した場合は、対応するソース ファイル名と行番号を表示します。 **-n** (行番号なし) パラメーターを指定すると、この動作を無効にできます。<br /><br />**-f** オプション (フル モード) を指定すると、マネージド フレームと、そのマネージド フレームのアセンブリ名および関数オフセットを混在させることでネイティブ フレームが表示されます。  このオプションでは、`dotnet-dump` と共に使用した場合、ネイティブ フレームは表示されません。<br /><br />**-r** オプションを指定すると、各スタック フレームのレジスタがダンプされます。<br /><br />**-all** オプションを指定すると、マネージド スレッドのスタックがすべてダンプされます。|
|**COMState**|COM アパートメント モデルを使用可能な場合、各スレッドと `Context` ポインターについてモデルを一覧表示します。 このコマンドは Windows でのみサポートされます。|
|**DumpArray** [ **-start** \<*startIndex*>] [ **-length** \<*length*>] **[-details]** **[-nofields]** \<*array object address*><br /><br /> \- または -<br /><br /> **DA** [ **-start** \<*startIndex*>] [ **-length** \<*length*>] **[-detail]** **[-nofields]** *array object address*>|配列オブジェクトの要素を調べます。<br /><br /> **-start** オプションは、要素の表示を始めるインデックス位置を指定します。<br /><br /> **-length** オプションは、表示する要素の数を指定します。<br /><br /> **-details** オプションは、**DumpObj** 形式および **DumpVC** 形式を使用して要素の詳細を表示します。<br /><br /> **-nofields** オプションは、配列が表示されないようにします。 **-detail** オプションを指定した場合にのみこのオプションを使用できます。|
|**DumpAsync** (**dumpasync**) [ **-mt** \<*MethodTable address*>] [ **-type** \<*partial type name*>] **[-waiting]** **[-roots]**|DumpAsync を使用して、ガベージ コレクション ヒープを走査し、非同期メソッドの状態がヒープに転送されるときに作成される非同期状態機械を表すオブジェクトを検索します。  このコマンドでは、`async void`、`async Task`、`async Task<T>`、`async ValueTask`、`async ValueTask<T>` として定義されている非同期状態機械が認識されます。<br /><br />出力には、検出された各非同期状態機械オブジェクトの詳細のブロックが含まれます。 詳細情報は次のとおりです。<br />- 非同期状態機械オブジェクトの種類の行。これには、その MethodTable アドレス、オブジェクト アドレス、サイズ、および種類の名前が含まれます。<br />- オブジェクトに含まれる状態機械の種類名の行。<br />- 状態機械の各フィールドの一覧。<br />- この状態機械オブジェクトからの継続の行 (1 つまたは複数が登録されている場合)。<br />- この非同期状態機械オブジェクトに対して検出された GC ルート。<br />|
|**DumpAssembly** \<*assembly address*>|アセンブリに関する情報を表示します。<br /><br /> **DumpAssembly** コマンドは、複数のモジュールが存在する場合はそれらを一覧表示します。<br /><br /> **DumpDomain** コマンドを使用するとアセンブリ アドレスを取得できます。|
|**DumpClass** \<*EEClass address*>|型に関連付けられている `EEClass` 構造体に関する情報を表示します。<br /><br /> **DumpClass** コマンドを実行すると静的フィールド値は表示されますが、非静的フィールド値は表示されません。<br /><br /> **DumpMT**、**DumpObj**、**Name2EE**、または **Token2EE** コマンドを使用して、`EEClass` 構造体のアドレスを取得します。|
|**DumpDomain** [\<*domain address*>]|指定した <xref:System.Reflection.Assembly> オブジェクトのアドレス内に読み込まれている各 <xref:System.AppDomain> オブジェクトを列挙します。  パラメーターを指定しないで呼び出すと、**DumpDomain** コマンドはプロセス内のすべての <xref:System.AppDomain> オブジェクトを一覧表示します。 .NET Core には <xref:System.AppDomain> が 1 つしかないため、**DumpDomain** からは 1 つのオブジェクトのみが返されます。|
|**DumpHeap** **[-stat]** **[-strings]** **[-short]** [ **-min** \<*size*>] [ **-max** \<*size*>] **[-thinlock]** **[-startAtLowerBound]** [ **-mt** \<*MethodTable address*>] [ **-type** \<*partial type name*>][*start* [*end*]]|ガベージ コレクトされたヒープと、オブジェクトの収集統計に関する情報を表示します。<br /><br /> ガベージ コレクター ヒープが過剰に断片化されていることを **DumpHeap** コマンドが検出すると、警告が表示されます。<br /><br /> **-stat** オプションは、統計的な型の概要のみを出力するよう制限を加えます。<br /><br /> **-strings** オプションは、統計的な文字列値の概要のみを出力するよう制限を加えます。<br /><br /> **-short** オプションは、各オブジェクトのアドレスだけに出力を制限します。 これにより、コマンドからの出力を別のデバッガー コマンドに簡単にパイプして、オートメーションを実現できます。<br /><br /> **-min** オプションは、バイト単位で指定された `size` パラメーター未満のオブジェクトを無視します。<br /><br /> **-max** オプションは、バイト単位で指定された `size` パラメーターを超えるオブジェクトを無視します。<br /><br /> **-thinlock** オプションは、ThinLocks を報告します。  詳細については、**SyncBlk** コマンドを参照してください。<br /><br /> `-startAtLowerBound` オプションは、指定したアドレス範囲の下限からヒープ ウォークを強制的に開始します。 計画フェーズの間は、オブジェクトが移動されているのでヒープをウォークできないことがよくあります。 このオプションを指定すると、**DumpHeap** に指定した下限から強制的にウォークを開始させることができます。 このオプションが機能するには、有効なオブジェクトのアドレスを下限として指定する必要があります。 無効なオブジェクトのアドレスのメモリを表示して、次のメソッド テーブルを手動で検索できます。 ガベージ コレクションが現在 `memcopy` を呼び出している場合は、パラメーターとして渡された開始アドレスにサイズを追加することで、次のオブジェクトのアドレスを特定することもできます。<br /><br /> **-mt** オプションは、指定した `MethodTable` 構造体に対応するオブジェクトのみを一覧表示します。<br /><br /> **-type** オプションは、指定した文字列に対して部分文字列一致する型名を持つオブジェクトのみを一覧表示します。<br /><br /> `start` パラメーターは、指定したアドレスから一覧表示を開始します。<br /><br /> `end` パラメーターは、指定したアドレスで一覧表示を終了します。|
|**DumpIL** \<*Managed DynamicMethod object*> &#124;       \<*DynamicMethodDesc pointer*> &#124;        \<*MethodDesc pointer*>|マネージド メソッドに関連付けられている Microsoft Intermediate Language (MSIL) を表示します。<br /><br /> 動的な MSIL は、アセンブリから読み込まれた MSIL とは異なる形式で出力されます。 動的な MSIL は、メタデータ トークンではなくマネージド オブジェクト配列内のオブジェクトを参照します。|
|**DumpLog** [ **-addr** \<*addressOfStressLog*>] [<*Filename*>]|メモリ内ストレス ログの内容を、指定したファイルに書き込みます。 名前を指定しないと、現在のディレクトリ内に StressLog.txt という名前のファイルが作成されます。<br /><br /> メモリ内ストレス ログを使用すると、ロックまたは I/O を使用せずにストレス エラーを診断できます。 ストレス ログを有効にするには、HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\\.NETFramework の下に次のレジストリ キーを設定します。<br /><br /> (DWORD) StressLog = 1<br /><br /> (DWORD) LogFacility = 0xffffffff<br /><br /> (DWORD) StressLogSize = 65536<br /><br /> 省略可能な `-addr` オプションを使用すると、デフォルト ログ以外のストレス ログを指定できます。|
|**DumpMD** \<*MethodDesc address*>|指定したアドレスにある `MethodDesc` 構造体に関する情報を表示します。<br /><br /> **IP2MD** コマンドを使用すると、マネージド関数から `MethodDesc` 構造体のアドレスを取得できます。|
|**DumpMT** **[-MD]** \<*MethodTable address*>|指定したアドレスにあるメソッド テーブルに関する情報を表示します。 **-MD** オプションを指定すると、オブジェクトに定義されているすべてのメソッドの一覧が表示されます。<br /><br /> 各マネージド オブジェクトにメソッド テーブルのポインターが含まれています。|
|**DumpModule** **[-mt]** \<*Module address*>|指定したアドレスにあるモジュールに関する情報を表示します。 **-mt** オプションは、モジュール内に定義されている型とモジュールから参照される型を表示します。<br /><br /> **DumpDomain** コマンドまたは **DumpAssembly** コマンドを使用すると、モジュールのアドレスを取得できます。|
|**DumpObj** **[-nofields]** \<*object address*><br /><br /> \- または -<br /><br /> **DO** \<*object address*>|指定したアドレスにあるオブジェクトに関する情報を表示します。 **DumpObj** コマンドを実行すると、フィールド、`EEClass` 構造体の情報、メソッド テーブル、およびオブジェクトのサイズが表示されます。<br /><br /> **DumpStackObjects** コマンドを使用すると、オブジェクトのアドレスを取得できます。<br /><br /> `CLASS` 型のフィールドはオブジェクトでもあるため、これに対して **DumpObj** コマンドを実行できます。<br /><br /> `-`**nofields** オプションは、オブジェクトのフィールドが表示されないようにします。これは、String のようなオブジェクトに便利です。|
|**DumpRuntimeTypes**|ガベージ コレクター ヒープの中にあるランタイムの型オブジェクトを表示し、それらに関連付けられている型名とメソッド テーブルを一覧表示します。|
|**DumpStack** **[-EE]** **[-n]** [`top` *stack* [`bottom` *stac*`k`]]|スタック トレースを表示します。<br /><br /> **DumpStack** コマンドで **-EE** オプションを指定すると、マネージド関数のみが表示されます。 `top` パラメーターおよび `bottom` パラメーターを使用して、x86 プラットフォーム上で表示するスタック フレームを制限します。<br /><br /> **-n** オプションを指定すると、ソース ファイル名と行番号の表示が無効になります。 デバッガーで SYMOPT_LOAD_LINES オプションが指定されている場合、SOS はすべてのマネージド フレームでシンボルを検索し、成功した場合は、対応するソース ファイル名と行番号を表示します。 **-n** (行番号なし) パラメーターを指定すると、この動作を無効にできます。<br /><br />
|**DumpSig** \<*sigaddr*> \<*moduleaddr*>|指定したアドレスにある `Sig` 構造体に関する情報を表示します。|
|**DumpSigElem** \<*sigaddr*> \<*moduleaddr*>|署名オブジェクトの 1 つの要素を表示します。 通常、個別の署名オブジェクトを調べるには **DumpSig** を使用する必要があります。 ただし、署名になんらかの破損がある場合は、**DumpSigElem** を使用して署名の無効な部分を読み取ることができます。|
|**DumpStackObjects** **[-verify]** [`top` *stack* [`bottom` *stack*]]<br /><br /> \- または -<br /><br /> **DSO** **[-verify]** [`top` *stack* [`bottom` *stack*]]|現在のスタックの範囲内で見つかったすべてのマネージド オブジェクトを表示します。<br /><br /> **-verify** オプションは、オブジェクト フィールドの静的でない各 `CLASS` フィールドを検証します。<br /><br /> **clrstack** コマンドと共に **K** (windbg) や **bt** (lldb) などのスタック トレース コマンドで **DumpStackObject** コマンドを使用して、ローカル変数とパラメーターの値を確認します。|
|**DumpVC** \<*MethodTable address*> \<*Address*>|指定したアドレスにある値クラスのフィールドに関する情報を表示します。<br /><br /> **DumpVC** コマンドで **MethodTable** パラメーターを指定すると、フィールドを正しく解釈できます。 値クラスでは、最初のフィールドがメソッド テーブルになることはありません。|
|**EEHeap** **[-gc]** **[-loader]**|内部のランタイム データ構造体によって消費されたプロセス メモリに関する情報を表示します。<br /><br /> **-gc** オプションと **-loader** オプションは、このコマンドによる出力を、ガベージ コレクターまたはローダーのデータ構造体のいずれかに制限します。<br /><br /> ガベージ コレクターの場合、マネージド ヒープの各セグメントの範囲内にある情報が一覧表示されます。  ポインターが **-gc** で指定されたセグメント内にある場合、そのポインターはオブジェクト ポインターです。|
|**EEStack** **[-short]** **[-EE]**|プロセス内のすべてのスレッドに対して **DumpStack** コマンドを実行します。<br /><br /> **-EE** オプションは、**DumpStack** コマンドに直接渡されます。 **-short** パラメーターは、次の種類のスレッドに出力を制限します。<br /><br />ロックを取得しているスレッド。<br /><br />ガベージ コレクションを実行できるように停止されているスレッド。<br /><br /> 現在マネージド コードにあるスレッド。|
|**EHInfo** [\<*MethodDesc address*>] [\<*Code address*>]|指定したメソッドの例外処理ブロックを表示します。  このコマンドを使用すると、句ブロック (`try` ブロック) およびハンドラー ブロック (`catch` ブロック) のコード アドレスとオフセットが表示されます。|
|**FAQ**|よく寄せられる質問を表示します。  `dotnet-dump`ではサポートされていません。|
|**FinalizeQueue** **[-detail]** &#124; **[-allReady]** **[-short]**|完了の目的で登録されているすべてのオブジェクトを表示します。<br /><br /> **-detail** オプションは、クリーンアップする必要があるすべての `SyncBlocks` およびクリーンアップの実行を待っているすべての `RuntimeCallableWrappers` (RCW) に関する特別な情報を表示します。 どちらのデータ構造体も、実行するとファイナライザー スレッドでキャッシュされクリーンアップされます。<br /><br /> `-allReady` オプションは、終了準備完了になっているすべてのオブジェクトを表示します。ガベージ コレクションによって既にそのようにマークされているオブジェクトも、次のガベージ コレクションによってマークされる予定のオブジェクトも同様に扱われます。 "終了準備完了" リストに含まれるオブジェクトは、既にルートがなくなっているファイナライズ可能なオブジェクトです。 このオプションは、ファイナライズ可能なキューに含まれるすべてのオブジェクトにまだルートがあるかどうかを検証するため、非常に負荷がかかる場合があります。<br /><br /> `-short` オプションは、各オブジェクトのアドレスに出力を制限します。 **-allReady** と組み合わせて使用すると、既にルートがなくなり、ファイナライザーが設定されているすべてのオブジェクトが列挙されます。 単独で使用した場合は、ファイナライズ可能な状態で "終了準備完了" キューに含まれるすべてのオブジェクトが一覧表示されます。|
|**FindAppDomain** \<*Object address*>|指定したアドレスにあるオブジェクトのアプリケーション ドメインを確認します。|
|**FindRoots** **-gen** \<*N*> &#124; **-gen any** &#124;\<*object address*>|指定したジェネレーションの次のコレクションでデバッガーがデバッグ対象を中断するようにします。 中断が発生すると、このオプションの効果はすぐにリセットされます。 次のコレクションで中断するには、コマンドを再度実行する必要があります。 このコマンドの *\<object address>* 形式は、 **-gen** または **-gen any** による中断が発生した後で使用します。 この時点で、デバッグ対象は **FindRoots** が現在の無効なジェネレーションからオブジェクトのルートを識別するのに適した状態になっています。 Windows でのみサポートされています。|
|**GCHandles** **[- perdomain]**|プロセス内のガベージ コレクター ハンドルに関する統計を表示します。<br /><br /> **-perdomain** オプションは、アプリケーション ドメイン別に統計を再配置します。<br /><br /> **GCHandles** コマンドを使用して、ガベージ コレクター ハンドルのリークによって発生するメモリ リークを検索します。 たとえば、厳密なガベージ コレクター ハンドルが大きな配列を指しているためコードがその配列を保持したままになっているときに、その配列を解放せずにハンドルを破棄すると、メモリ リークが発生します。 <br /><br />Windows でのみサポートされています。|
|**GCHandleLeaks**|プロセスの強力なガベージ コレクター ハンドルおよび固定されたガベージ コレクター ハンドルへの参照についてメモリ内を検索し、結果を表示します。 ハンドルが見つかった場合、**GCHandleLeaks** コマンドは参照のアドレスを表示します。 メモリ内にハンドルが見つからない場合、このコマンドは通知を表示します。 Windows でのみサポートされています。|
|**GCInfo** \<*MethodDesc address*>\<*Code address*>|レジスタまたはスタックの場所にマネージド オブジェクトが格納された時期を示すデータを表示します。 ガベージ コレクションを実行する場合は、コレクターはオブジェクトに対する参照の場所を把握しておく必要があります。その結果、新しいオブジェクト ポインターの値を使用して参照を更新できます。|
|**GCRoot** **[-nostacks]** **[-all]** \<*Object address*>|指定したアドレスにあるオブジェクトへの参照 (またはルート) に関する情報を表示します。<br /><br /> **GCRoot** コマンドは、マネージド ヒープ全体と、スタック上の他のオブジェクトおよびハンドル内にあるハンドルから成るハンドル テーブルを調べます。 次に、オブジェクトへのポインターについて各スタックを検索し、さらにファイナライザー キューも検索します。<br /><br /> このコマンドは、スタック ルートが有効かまたは破棄されているかどうかを確認しません。 スタック ルートがまだ使用されているかどうかを確認するには、**clrstack** および **U** コマンドを使用して、ローカルまたは引数の値が属するフレームを逆アセンブルします。<br /><br /> **-nostacks** オプションは、ガベージ コレクター ハンドルおよび到達可能なオブジェクトのみを検索するように制限を加えます。<br /><br /> **-all** オプションを指定すると、一意のルートだけでなく、すべてのルートが強制的に表示されます。|
|**GCWhere**  *\<object address>*|渡された引数のガベージ コレクション ヒープ内での位置とサイズを表示します。 引数がマネージド ヒープ内にあっても、有効なオブジェクト アドレスではない場合は、サイズは 0 (ゼロ) と表示されます。|
|**Help** (**soshelp**) [\<*command*>] [`faq`]|パラメーターを指定しない場合は、使用できるすべてのコマンドを表示します。パラメーターとしてコマンドを指定した場合は、そのコマンドに関する詳細なヘルプを表示します。<br /><br /> `faq` パラメーターを指定すると、よく寄せられる質問に対する回答が表示されます。|
|**HeapStat** [ **-inclUnrooted** &#124; **-iu**]|各ヒープのジェネレーション サイズ、および各ヒープの各ジェネレーションでの合計空き領域を表示します。 -**inclUnrooted** オプションを指定すると、レポートには既にルートがないガベージ コレクション ヒープからのマネージド オブジェクトに関する情報が含まれます。 Windows でのみサポートされています。|
|**HistClear**|`Hist` コマンドのファミリによって使用されているすべてのリソースを解放します。<br /><br /> 通常は、`HistClear` を明示的に呼び出す必要はありません。各 `HistInit` が前のリソースをクリーンアップします。|
|**HistInit**|デバッグ対象に保存されているストレス ログから SOS 構造体を初期化します。|
|**HistObj** *<obj_address>*|すべてのストレス ログ再配置レコードを調べて、引数として渡されたアドレスになった可能性のあるガベージ コレクション再配置のチェーンを表示します。|
|**HistObjFind**  *<obj_address>*|指定したアドレスにあるオブジェクトを参照するすべてのログ エントリを表示します。|
|**HistRoot** *\<root>*|指定したルートの上位変換と再配置の両方に関係する情報を表示します。<br /><br /> ルートの値を使用すると、ガベージ コレクション内でのオブジェクトの移動を追跡できます。|
|**IP2MD** (**ip2md**) \<*Code address*>|JIT コンパイルされたコード内の指定したアドレスにある `MethodDesc` 構造体を表示します。|
|**ListNearObj** (**lno**) *<obj_address>*|指定したアドレスの前および後にあるオブジェクトを表示します。 このコマンドは、マネージド オブジェクトの開始時に (有効メソッド テーブルに基づいて) 有効であると考えられるガベージ コレクション ヒープ内のアドレス、および引数アドレスの後のオブジェクトを検索します。 Windows でのみサポートされています。|
|**MinidumpMode** **[0]** **[1]**|ミニダンプを使用するときに安全でないコマンドが実行されるのを防止します。<br /><br /> この機能を無効にするには **0** を渡し、機能を有効にするには **1** を渡します。 既定では、**MinidumpMode** の値は **0** に設定されます。<br /><br /> **.dump /m** コマンドまたは **.dump** コマンドで作成されるミニダンプの内容は CLR 固有のデータに制限され、このミニダンプは SOS コマンドのサブセットでのみ正しく実行できます。 一部のコマンドはメモリの必要領域が割り当てられていないか一部分しか割り当てられていないため、予期しないエラーが発生して失敗することがあります。 このオプションは、ミニダンプに対して安全でないコマンドが実行されるのを防止します。 <br /><br />Windbg でのみサポートされています。|
|**Name2EE** (**name2ee**) \<*module name*> \<*type or method name*><br /><br /> \- または -<br /><br /> **Name2EE** \<*module name*> **!** \<*type or method name*>|指定したモジュール内の指定した型またはメソッドの `MethodTable` 構造体および `EEClass` 構造体を表示します。<br /><br /> 指定したモジュールをプロセスに読み込む必要があります。<br /><br /> 適切な型名を取得するには、[Ildasm.exe (IL 逆アセンブラー)](../../../docs/framework/tools/ildasm-exe-il-disassembler.md) を使用してモジュールを参照します。 また、`*` を module name パラメーターとして渡すと、読み込まれているすべてのマネージド モジュールを検索できます。 *モジュール名* パラメーターには、`mscorlib`、`image00400000` など、デバッガーのモジュールの名前も指定できます。<br /><br /> このコマンドは、Windows のデバッガー構文 <`module`>`!`<`type`> をサポートします。 型は、完全修飾する必要があります。|
|**ObjSize** [\<*Object address*>] &#124; **[-aggregate]** **[-stat]**|指定したオブジェクトのサイズを表示します。 パラメーターを何も指定しないで **ObjSize** コマンドを使用すると、マネージド スレッドで見つかったすべてのオブジェクトのサイズが表示され、プロセス内のすべてのガベージ コレクター ハンドル、およびそれらのハンドルが指すオブジェクトのサイズの合計が表示されます。 **ObjSize** コマンドの結果には、親オブジェクトに加え、すべての子オブジェクトのサイズが含まれます。<br /><br /> **-aggregate** オプションを **-stat** 引数と組み合わせて使用すると、まだルートがある型の詳細なビューを取得できます。 **!dumpheap -stat** と **!objsize -aggregate -stat** を使用することで、既にルートがなくなっているオブジェクトを判別し、メモリに関するさまざまな問題を診断できます。 <br /><br /> Windows でのみサポートされています。|
|**PrintException** **[-nested]** **[-lines]** [\<*Exception object address*>]<br /><br /> \- または -<br /><br /> **PE** **[-nested]** [\<*Exception object address*>]|指定したアドレスにある <xref:System.Exception> クラスから派生したすべてのオブジェクトのフィールドが表示および書式設定されます。 アドレスを指定しないで **PrintException** コマンドを使用すると、現在のスレッドで最後にスローされた例外が表示されます。<br /><br /> **-nested** オプションは、入れ子になった例外オブジェクトに関する詳細を表示します。<br /><br /> **-lines** オプションは、ソース情報を表示します (存在する場合)。<br /><br /> このコマンドを使用すると、バイナリ配列の `_stackTrace` フィールドを書式設定して表示できます。|
|**ProcInfo** **[-env]** **[-time]** **[-mem]**|プロセスの環境変数、カーネル CPU 時間、およびメモリ使用率統計を表示します。 Windbg でのみサポートされています。|
|**RCWCleanupList** \<*RCWCleanupList address*>|指定したアドレスにあり、クリーンアップを待っているランタイム呼び出し可能ラッパーの一覧を表示します。 Windbg でのみサポートされています。|
|**SaveModule** \<*Base address*> \<*Filename*>|メモリ内の指定したアドレスに読み込まれているイメージを、指定したファイルに書き込みます。 Windbg でのみサポートされています。|
|**SetHostRuntime** [\<runtime-directory\>]|このコマンドにより、デバッガー (lldb) で SOS の一部として実行されるマネージド コードをホストするために使用する .NET Core ランタイムへのパスが設定されます。 ランタイムは少なくともバージョン 2.1.0 以上である必要があります。 ディレクトリ内にスペースがある場合は、単一引用符 (') で囲む必要があります。<br/><br/>通常は、SOS でそのマネージド コードを自動的に実行するためにインストールされている .NET Core ランタイムの検出が試行されますが、それに失敗した場合はこのコマンドを使用できます。 既定では、デバッグされるのと同じランタイム (libcoreclr) を使用します。 デバッグされる既定のランタイムが SOS コードを実行するのに十分に動作していない場合や、バージョンが 2.1.0 未満の場合は、このコマンドを使用します。<br/><br/>SOS コマンドの実行時に次のエラー メッセージが表示された場合は、このコマンドを使用して、パスを 2.1.0 以上の .NET Core ランタイムに設定します。 <br/><br/>`(lldb) clrstack`<br/>`Error: Fail to initialize CoreCLR 80004005 ClrStack failed`<br/><br/>`(lldb) sethostruntime /usr/share/dotnet/shared/Microsoft.NETCore.App/2.1.6`<br/><br/>コマンド シェルで "dotnet --info" を使用して、インストールされている .NET Core ランタイムのパスを見つけることができます。|
|**SetSymbolServer** **[-ms]** **[-disable]** **[-log]** **[-loadsymbols]** [ **-cache** \<cache-path>] [ **-directory** \<search-directory>] [ **-sympath** \<windows-symbol-path>] [\<symbol-server-URL>]|シンボル サーバーのダウンロード サポートを有効にします。<br/><br/>**-ms** オプションを指定すると、パブリックの Microsoft シンボル サーバーからのダウンロードが有効になります。<br/><br/>**-disable** オプションを指定すると、シンボルのダウンロード サポートが有効になります。<br/><br/>**-cache** \<cache-path> オプションでは、シンボルのキャッシュ ディレクトリを指定します。 指定されていない場合、既定値は $HOME/.dotnet/symbolcache となります。<br/><br/>**directory** オプションを指定すると、シンボルを検索するためのパスが追加されます。 これは複数にすることができます。<br/><br/>**-sympath** オプションを指定すると、Windows のシンボル パス形式でサーバー、キャッシュ、およびディレクトリのパスが追加されます。<br/><br/>**-log** オプションを指定すると、シンボルのダウンロードのログ記録が有効になります。<br/><br/>**-loadsymbols** オプションを指定すると、ランタイムのネイティブ .NET Core シンボルのダウンロードが試行されます。 lldb および dotnet-dump でサポートされています|
|**SOSFlush**|内部 SOS キャッシュをフラッシュします。|
|**SOSStatus** **[-reset]**|内部 SOS の状態を表示するか、内部のキャッシュされた状態をリセットします。|
|**StopOnException** **[-derived]** [ **-create** &#124; **-create2**] \<*Exception*> \<*Pseudo-register number*>|指定した例外がスローされたときにデバッガーを停止しますが、それ以外の例外がスローされたときは実行を続行します。<br /><br /> **-derived** オプションは、指定した例外、および指定した例外から派生したすべての例外をキャッチします。 <br /><br /> Windbg でのみサポートされています。|
|**SyncBlk** [ **-all** &#124; \<*syncblk number*>]|指定した `SyncBlock` 構造体またはすべての `SyncBlock` 構造体を表示します。  **SyncBlk** コマンドに引数を渡さない場合は、スレッドが所有しているオブジェクトに対応する `SyncBlock` 構造体が表示されます。<br /><br /> `SyncBlock` 構造体は、オブジェクトによっては作成する必要のないこともある追加情報のコンテナーです。 この構造体は、COM 相互運用機能データ、ハッシュ コード、およびスレッド セーフ操作用のロック情報を保持できます。|
|**ThreadPool**|キュー内の作業要求の数、完了ポート スレッドの数、タイマーの数を含め、マネージド スレッド プールに関する情報を表示します。|
|**Threads** (**clrthreads**) **[-live]** **[-special]**|プロセス内のすべてのマネージド スレッドを表示します。<br /><br /> **Threads** コマンドを使用すると、デバッガーの短縮 ID、CLR のスレッド ID、およびオペレーティング システムのスレッド ID が表示されます。  さらに、**Threads** コマンドでは、スレッドを実行しているアプリケーション ドメインを示すドメイン列、COM アパートメント モードが表示される APT 列、およびスレッド内の最後にスローされた例外が表示される例外列が表示されます。<br /><br /> **-live** オプションは、ライブ スレッドに関連付けられているスレッドを表示します。<br /><br /> **-special** オプションは、CLR で作成されたすべての特殊なスレッドを表示します。 特殊なスレッドには、同時実行ガベージ コレクションおよびサーバー ガベージ コレクションのガベージ コレクション スレッド、デバッガー ヘルパー スレッド、ファイナライザー スレッド、<xref:System.AppDomain> アンロード スレッド、およびスレッド プール タイマー スレッドがあります。|
|**ThreadState \<** *State value field* **>**|スレッドの状態を表示します。 `value` パラメーターは、**Threads** レポート出力の `State` フィールドの値です。|
|**Token2EE** \<*module name*> \<*token*>|指定したモジュール内の指定したメタデータ トークンを `MethodTable` 構造体または `MethodDesc` 構造体に変換します。<br /><br /> module name パラメーターに `*` を渡すと、読み込まれているすべてのマネージド モジュール内にあるそのトークンの割り当て先を検索できます。 また、デバッガーの `mscorlib`、`image00400000` などのモジュール名を渡すこともできます。|
|**U** **[-gcinfo]** **[-ehinfo]** **[-n]** \<*MethodDesc address*> &#124; \<*Code address*>|メソッドの `MethodDesc` 構造体ポインターまたはメソッド本体のコード アドレスで指定したマネージド メソッドの注釈付き逆アセンブリを表示します。 **U** コマンドを使用すると、開始から終了までのすべてのメソッドが、メタデータ トークンを名前に変換する注釈付きで表示されます。<br /><br /> **U** コマンドの **-gcinfo** オプションを指定すると、メソッドの `GCInfo` 構造体が表示されます。<br /><br /> **-ehinfo** オプションは、メソッドの例外情報を表示します。 この情報は **EHInfo** コマンドでも取得できます。<br /><br /> **-n** オプションを指定すると、ソース ファイル名と行番号の表示が無効になります。 デバッガーで SYMOPT_LOAD_LINES オプションが指定されている場合、SOS はすべてのマネージド フレームでシンボルを検索し、成功した場合は、対応するソース ファイル名と行番号を表示します。 **-n** オプションを指定すると、この動作を無効にできます。|
|**VerifyHeap**|ガベージ コレクター ヒープの破損の兆候をチェックし、検出されたすべてのエラーを表示します。<br /><br /> ヒープが正しく構築されていない場合、プラットフォームが呼び出しを実行したことが原因で、ヒープが破損する可能性があります。 |
|**VerifyObj** \<*object address*>|引数として渡されたオブジェクトで破損の兆候を調べます。 Windows でのみサポートされています。|
|**VMMap**|仮想アドレス空間を走査し、各領域に適用されている保護方法の種類を表示します。 Windbg でのみサポートされています。|
|**VMStat**|仮想アドレス空間の概要を、そのメモリに適用されている保護方法の種類 (保護なし、予約済み、コミット、プライベート、割り当て済み、イメージ) の順に表示します。 AVERAGE 列に BLK COUNT 列を掛けた結果が TOTAL 列に表示されます。 Windbg でのみサポートされています。|

### <a name="dotnet-dump"></a>Dotnet-Dump

`dotnet-dump analyze` で使用できる SOS コマンドの一覧については、「[dotnet-dump](dotnet-dump.md#analyze-sos-commands)」を参照してください。

### <a name="windows-debugger"></a>Windows デバッガー

SOS デバッガー拡張は、[WinDbg/dbg デバッガー](/windows-hardware/drivers/debugger/debugger-download-tools)に読み込み、Windows デバッガー内でコマンドを実行することで使用することもできます。  SOS コマンドはライブ プロセスまたはダンプで使用できます。

Windows デバッガーに SOS デバッガー拡張を読み込むには、ツールで次のコマンドを実行します。

```console
.loadby sos clr
```

WinDbg.exe と Visual Studio は、現在使用している Mscorwks.dll のバージョンに対応する SOS.dll のバージョンを使用します。 既定では、Mscorwks.dll の現在のバージョンに一致する SOS.dll のバージョンを使用することになります。

別のコンピューターで作成されたダンプ ファイルを使用するには、そのインストールに付属していた Mscorwks.dll ファイルが現在のコンピューターのシンボル パスにあることを確認し、対応するバージョンの SOS.dll を読み込みます。

特定のバージョンの SOS.dll を読み込むには、Windows デバッガーに次のコマンドを入力します。

```console
.load <full path to sos.dll>
```

### <a name="lldb-debugger"></a>LLDB デバッガー

LLDB の SOS を構成する手順については、「[dotnet-sos](dotnet-sos.md)」を参照してください。 SOS コマンドはライブ プロセスまたはダンプで使用できます。

既定では、「`sos [command\_name]`」と入力することで、すべての SOS コマンドに到達できます。 しかし、共通のコマンドには、`sos` プレフィックスが不要になるように別名が付けられています。

| コマンド                               | 機能
| ------------------------------------- | ---------------------------------------------------------------------------------------------
|    `bpmd`                             | 指定されたモジュールの指定のマネージド メソッドにブレークポイントを作成します。
|    `clrstack`                         | マネージド コードのみのスタック トレースを提供します。
|    `clrthreads`                       | 実行中のマネージド スレッドを一覧表示します。
|    `clru`                             | マネージド メソッドの注釈付き逆アセンブリを表示します。
|    `dso`                              | 現在のスタックの範囲内で見つかったすべてのマネージド オブジェクトを表示します。
|    `dumpasync`                        | ガベージ コレクトされたヒープ上の非同期状態機械に関する情報を表示します。
|    `dumpclass`                        | 指定されたアドレスにある `EEClass` 構造体に関する情報を表示します。
|    `dumpdomain`                       | すべての AppDomain と、指定されたドメイン内のすべてのアセンブリに関する情報を表示します。
|    `dumpheap`                         | ガベージ コレクトされたヒープと、オブジェクトの収集統計に関する情報を表示します。
|    `dumpil`                           | マネージド メソッドに関連付けられている Microsoft Intermediate Language (MSIL) を表示します。
|    `dumplog`                          | メモリ内ストレス ログの内容を、指定したファイルに書き込みます。
|    `dumpmd`                           | 指定されたアドレスにある `MethodDesc` 構造体に関する情報を表示します。
|    `dumpmodule`                       | 指定されたアドレスにあるモジュールに関する情報を表示します。
|    `dumpmt`                           | 指定されたアドレスにあるメソッド テーブルに関する情報を表示します。
|    `dumpobj`                          | 指定されたアドレスにあるオブジェクトに関する情報を表示します。
|    `dumpstack`                        | ネイティブおよびマネージド スタック トレースを表示します。
|    `eeheap`                           | 内部のランタイム データ構造体によって消費されたプロセス メモリに関する情報を表示します。
|    `eestack`                          | プロセス内のすべてのスレッドに対して `dumpstack` を実行します。
|    `gcroot`                           | 指定されたアドレスにあるオブジェクトへの参照 (またはルート) に関する情報を表示します。
|    `histclear`                        | Hist コマンドのファミリによって使用されているすべてのリソースを解放します。
|    `histinit`                         | デバッグ対象に保存されているストレス ログから SOS 構造体を初期化します。
|    `histobj`                          | すべてのストレス ログ再配置レコードを調べて、引数として渡されたアドレスになった可能性のあるガベージ コレクション再配置のチェーンを表示します。
|    `histobjfind`                      | 指定されたアドレスにあるオブジェクトを参照するすべてのログ エントリを表示します。
|    `histroot`                         | 指定したルートの上位変換と再配置の両方に関係する情報を表示します。
|    `ip2md`                            | JIT コンパイルされたコード内の指定したアドレスにある `MethodDesc` 構造体を表示します。
|    `loadsymbols`                      | .NET Core ネイティブ モジュール シンボルを読み込みます。
|    `name2ee`                          | 指定されたモジュール内の指定の型またはメソッドの `MethodTable` および `EEClass` 構造体を表示します。
|    `pe`                               | 指定したアドレスにある <xref:System.Exception> クラスから派生したすべてのオブジェクトのフィールドが表示および書式設定されます。
|    `setclrpath`                       | coreclr dac または dbi ファイルを読み込むためのパスを設定します。 `setclrpath <path>`
|    `sethostruntime`                   | マネージド コードを SOS で実行するために使用する .NET Core ランタイム ディレクトリを設定または表示します。
|    `setsymbolserver`                  | シンボル サーバーのサポートを有効にします。
|    `setsostid`                        | lldb で提供されるものを使用する代わりに、現在の OS tid またはスレッド インデックスを設定します。 `setsostid <tid> <index>`
|    `sos`                              | さまざまな coreclr デバッグ コマンド。 詳細については、「soshelp」を参照してください。 `sos <command-name> <args>`
|    `soshelp`                          | パラメーターが指定されていない場合に使用可能なすべてのコマンドを表示するか、指定された `soshelp <command>` コマンドに関する詳細なヘルプ情報を表示します。
|    `syncblk`                          | SyncBlock の所有者の情報を表示します。

## <a name="windbgcdb-example-usage"></a>Windbg/cdb の使用例

| コマンド  | 説明
| - | -
| `!dumparray -start 2 -length 5 -detail 00ad28d0` | アドレス `00ad28d0` にある配列の内容を表示します。  2 番目の要素およびそれ以降にある合計 5 つの要素が表示されます。
| `!dumpassembly 1ca248` | アドレス `1ca248` にあるアセンブリの内容を表示します。
| `!dumpheap` | ガベージ コレクター ヒープに関する情報を表示します。
| `!DumpLog` | メモリ内ストレス ログの内容を、現在のディレクトリ内にある StressLog.txt という (既定の) ファイルに書き込みます。
 `!dumpmd 902f40` | アドレス `902f40` にある `MethodDesc` 構造体を表示します。
| `!dumpmodule 1caa50` | アドレス `1caa50` にあるモジュールに関する情報を表示します。
| `!DumpObj a79d40` | アドレス `a79d40` にあるオブジェクトに関する情報を表示します。
| `!DumpVC 0090320c 00a79d9c` | アドレス `0090320c`にあるメソッド テーブルを使用して、アドレス `00a79d9c` にある値クラスのフィールドを表示します。
| `!eeheap` -gc | ガベージ コレクターによって使用されるプロセス メモリを表示します。
| `!finalizequeue` | 終了処理のためにスケジュールされているすべてのオブジェクトを表示します。
| `!findappdomain 00a79d98` |  アドレス `00a79d98` にあるオブジェクトのアプリケーション ドメインを確認します。
| `!gcinfo 5b68dbb8` | 現在のプロセス内のすべてのガベージ コレクター ハンドルを表示します。
| `!name2ee unittest.exe MainClass.Main` | モジュール `unittest.exe` にある `MainClass` クラスの `Main` メソッドの `MethodTable` および `EEClass` 構造体を表示します。
| `!token2ee unittest.exe 02000003` | モジュール `unittest.exe` のアドレス `02000003` にあるメタデータ トークンに関する情報を表示します。

## <a name="lldb-example-usage"></a>LLDB の使用例

| コマンド  | 説明
| - | -
| `sos DumpArray -start 2 -length 5 -detail 00ad28d0` | アドレス `00ad28d0` にある配列の内容を表示します。  2 番目の要素およびそれ以降にある合計 5 つの要素が表示されます。
| `sos DumpAssembly 1ca248` | アドレス `1ca248` にあるアセンブリの内容を表示します。
| `dumpheap` | ガベージ コレクター ヒープに関する情報を表示します。
| `dumplog` | メモリ内ストレス ログの内容を、現在のディレクトリ内にある StressLog.txt という (既定の) ファイルに書き込みます。
| `dumpmd 902f40` | アドレス `902f40` にある `MethodDesc` 構造体を表示します。
| `dumpmodule 1caa50` | アドレス `1caa50` にあるモジュールに関する情報を表示します。
| `dumpobj a79d40` | アドレス `a79d40` にあるオブジェクトに関する情報を表示します。
| `sos DumpVC 0090320c 00a79d9c` | アドレス `0090320c`にあるメソッド テーブルを使用して、アドレス `00a79d9c` にある値クラスのフィールドを表示します。
| `eeheap -gc` | ガベージ コレクターによって使用されるプロセス メモリを表示します。
| `sos FindAppDomain 00a79d98` | アドレス `00a79d98` にあるオブジェクトのアプリケーション ドメインを確認します。
| `sos GCInfo 5b68dbb8` | 現在のプロセス内のすべてのガベージ コレクター ハンドルを表示します。
| `name2ee unittest.exe MainClass.Main` | モジュール `unittest.exe` にある `MainClass` クラスの `Main` メソッドの `MethodTable` および `EEClass` 構造体を表示します。
| `sos Token2EE unittest.exe 02000003` | モジュール `unittest.exe` のアドレス `02000003` にあるメタデータ トークンに関する情報を表示します。
| `clrthreads` | マネージド スレッドを表示します。

## <a name="see-also"></a>関連項目

- [.NET でのダンプの概要](dumps.md)
- [.NET Core でメモリ リークをデバッグする方法について学習する](debug-memory-leak.md)
- [メモリ ダンプの収集と分析に関するブログ](https://devblogs.microsoft.com/dotnet/collecting-and-analyzing-memory-dumps/)
- [ダンプ分析ツール (dotnet-dump)](dotnet-dump.md)
- [SOS インストール ツール (dotnet-sos)](dotnet-sos.md)
- [ヒープ分析ツール (dotnet-gcdump)](dotnet-gcdump.md)
