---
title: モデル ビルダーの概要としくみ
description: ML.NET モデル ビルダーを使用し、機械学習モデルを自動的にトレーニングする方法
ms.date: 06/01/2020
ms.custom: overview, mlnet-tooling
ms.openlocfilehash: 2ed4a0c3c94ae9f46bb1cf6ddb1e9774baf82367
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/02/2020
ms.locfileid: "84289500"
---
# <a name="what-is-model-builder-and-how-does-it-work"></a>モデル ビルダーの概要としくみ

ML.NET モデル ビルダーは、直観的なグラフィックスでカスタムの機械学習モデルを構築、トレーニング、展開できる Visual Studio 拡張機能です。

モデル ビルダーでは自動化された機械学習 (AutoML) を利用してさまざまな機械学習のアルゴリズムや設定を見つけます。自分のシナリオに最適なものを見つけるのに役立ちます。

モデル ビルダーは機械学習の専門知識がなくても使用できます。 必要なものはいくつかのデータと解決すべき問題です。 モデル ビルダーでは、.NET アプリケーションにモデルを追加するコードが生成されます。

![モデル ビルダー Visual Studio 拡張機能のユーザー インターフェイスのアニメーション](media/ml-dotnet-model-builder.gif)

> [!NOTE]
> モデル ビルダーは現在のところ、プレビュー段階です。

## <a name="scenario"></a>シナリオ

さまざまなシナリオをモデル ビルダーに取り込み、自分のアプリケーションのための機械学習モデルを生成できます。

シナリオは、自分のデータを使用して行う予測の種類を説明するものです。 次に例を示します。

- 過去の販売データに基づいて今後の製品売上高を予測する
- 顧客のレビューに基づいてセンチメントを肯定的と否定的に分類する
- 銀行取引が詐欺かどうかを検出する
- 顧客がフィードバックした問題を社内の該当チームに送信する

### <a name="which-machine-learning-scenario-is-right-for-me"></a>自分に最適な機械学習シナリオとは?

モデル ビルダーでは、シナリオを選択する必要があります。 シナリオの種類は、行おうとしている予測の種類によって異なります。

#### <a name="text-classification"></a>テキスト分類

分類は、データをカテゴリに分類するために使用されます。

![不正検出、リスク軽減、アプリケーション スクリーニングなど、二項分類の例を示す図](media/binary-classification-examples.png)

![ドキュメントと製品の分類、サポート チケットのルーティング、顧客の問題の優先度設定など、多クラス分類の例](media/multiclass-classification-examples.png)

#### <a name="value-prediction"></a>値の予測

回帰は、数値を予測する目的で利用されます。

![価格予測、売上予測、予測メンテナンスなどの回帰の例を示す図](media/regression-examples.png)

#### <a name="image-classification"></a>イメージ分類

イメージ分類を使用すると、さまざまなカテゴリのイメージを特定できます。 これには、さまざまな種類の地形、動物、製造上の不具合などが含まれます。

一連のイメージがあり、イメージをさまざまなカテゴリに分類したいときは、イメージ分類シナリオを使用できます。

#### <a name="recommendation"></a>推奨事項

推奨事項シナリオでは、他のユーザーとの好きや嫌いの類似度に基づいて、特定のユーザーに対する提案項目の一覧が予測されます。

ユーザーのセットと、"製品" のセット (購入する品目、映画、本、テレビ番組など)、およびそれらの製品に対するユーザーの "評価" のセットがある場合は、推奨事項シナリオを使用できます。

## <a name="environment"></a>環境

お使いのコンピューター上のローカル環境で、または Azure 上のクラウドで、機械学習モデルをトレーニングできます。

ローカル環境でトレーニングする場合は、コンピューター リソース (CPU、メモリ、ディスク) の制約内で作業します。 クラウドでトレーニングする場合は、シナリオのニーズに合わせて、リソースをスケールアップできます (特に大規模なデータセット)。

ローカル トレーニングは、すべてのシナリオでサポートされています。

Azure トレーニングは、イメージ分類でサポートされています。

## <a name="data"></a>データ

シナリオを選択すると、モデル ビルダーからデータセットを提供するように求められます。 このデータはモデルをトレーニングし、評価し、シナリオに最適なモデルを選択するために使用されます。

![モデル ビルダーの手順を示す図](media/model-builder-steps.png)

モデル ビルダーは、.tsv、.csv、.txt 形式のデータセットと、SQL データベース形式をサポートしています。 .txt ファイルがある場合、列は `,`、`;`、または `/t` で区切る必要があり、ファイルにはヘッダー行が必要です。

データセットがイメージで構成されている場合、サポートされているファイルの種類は `.jpg` と `.png`です。

詳細については、「[モデル ビルダーにトレーニング データを読み込む](how-to-guides/load-data-model-builder.md)」を参照してください。

### <a name="choose-the-output-to-predict-label"></a>予測する出力を選択します (ラベル)

データセットは、トレーニング サンプルの行と属性の列からなるテーブルです。 各行の内容:

- **ラベル** (予測する属性)
- **特徴** (ラベルを予測するための入力として使用される属性)。

家の価格予測シナリオの場合、特徴は次のようになります。

- 家の面積
- 寝室と浴室の数
- 郵便番号

ラベルは、面積、寝室数、浴室数、郵便番号からなるその行の過去の住宅価格です。

![サイズ、部屋数、郵便番号、価格ラベルから構成される特徴を持つ住宅価格データからなる行と列を示す表](media/model-builder-data.png)

### <a name="example-datasets"></a>データセットの例

独自のデータをまだ用意していない場合、次のいずれかのデータセットをお試しください。

|シナリオ|例|データ|ラベル|フィーチャー|
|-|-|-|-|-|
|分類|売上の異常を予測する|[製品の売上データ](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/getting-started/AnomalyDetection_Sales/SpikeDetection/Data/product-sales.csv)|製品の売上|月|
||Web サイトのコメントのセンチメントを予測する|[Web サイトのコメント データ](https://raw.githubusercontent.com/dotnet/machinelearning/master/test/data/wikipedia-detox-250-line-data.tsv)|ラベル (否定的なセンチメントのときは 0、肯定的なセンチメントのときは 1)|コメント、年度|
||クレジット カード取引の詐欺を予測する|[クレジット カードのデータ](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/getting-started/BinaryClassification_CreditCardFraudDetection/CreditCardFraudDetection.Trainer/assets/input/creditcardfraud-dataset.zip)|クラス (詐欺の場合は 1、それ以外の場合 0)|金額、V1-V28 (匿名化された特徴)|
||GitHub リポジトリでのイシューの種類を予測する|[GitHub 問題のデータ](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/end-to-end-apps/MulticlassClassification-GitHubLabeler/GitHubLabeler/Data/corefx-issues-train.tsv)|区分|タイトル、説明|
|値の予測|タクシー料金を予測する|[タクシーの料金データ](https://github.com/dotnet/machinelearning-samples/blob/master/datasets/taxi-fare-train.csv)|料金|乗車時間、距離|
|イメージ分類|花の種類を予測する |[花の画像](http://download.tensorflow.org/example_images/flower_photos.tgz)|花の種類: デイジー、タンポポ、バラ、ヒマワリ、チューリップ|イメージ データ自体|
|推奨事項|好きな映画を予測する|[映画の評価](http://files.grouplens.org/datasets/movielens/ml-latest-small.zip)|ユーザー、映画|評価|

## <a name="train"></a>トレーニング

シナリオ、環境、データ、ラベルを選択すると、モデル ビルダーによってモデルがトレーニングされます。

### <a name="what-is-training"></a>トレーニングとは何か?

トレーニングとは、モデル ビルダーがシナリオの質問に対する回答方法をモデルに教える自動プロセスです。 トレーニングが終わると、モデルは以前に見たことがない入力データで予測できます。 たとえば、住宅価格を予測しているなら、新しい住宅が市場に出たとき、その販売価格を予測できます。

モデル ビルダーで使用される機械学習は自動化されているため (AutoML)、トレーニング中に、ユーザーが入力したり、調整したりする必要がありません。

### <a name="how-long-should-i-train-for"></a>どのくらいの時間、トレーニングしますか?

モデル ビルダーは、AutoML を使用して複数のモデルを探索し、最適なパフォーマンスを発揮するモデルを見つけます。

トレーニング期間を長くすると、AutoML はより広い設定範囲でさらに多くのモデルを探索できます。

以下の表は、ローカル コンピューターにある一連のサンプル データセットで、優れたパフォーマンスを得るのに要した平均時間を示しています。

|データセットのサイズ|トレーニングの平均時間|
|------------|---------------------|
|0 - 10 MB|10 秒|
|10 - 100 MB|10 分|
|100 - 500 MB|30 分|
|500 MB - 1 GB|60 分|
|1 GB 超|3 時間超|

これらは参考用の数字に過ぎません。 トレーニングの正確な長さは、次の条件によって異なります。

- モデルへの入力として使用されている特徴 (列) の数
- 列の種類
- ML タスク
- トレーニングに使用されるマシンの CPU、ディスク、およびメモリのパフォーマンス

通常は、データセットとして 100 行より多くの行を使用することをお勧めします。それ以下では、何も結果が生成されない場合や、トレーニングにかなりの時間がかかる場合があります。

## <a name="evaluate"></a>評価

評価は、モデルがどのくらい適切かを測定するプロセスです。 モデル ビルダーは、トレーニングしたモデルを使用して新しいテスト データで予測し、予測の精度を測定します。

モデル ビルダーでは、トレーニング セットとテスト セットにトレーニング データが分割されます。 トレーニング データ (80%) はモデルのトレーニングに使用されます。テスト データ (20%) はモデルの評価のための控えとなります。

### <a name="how-do-i-understand-my-model-performance"></a>モデルのパフォーマンスを把握するには

シナリオが機械学習タスクにマップされます。 各 ML タスクには、独自の評価メトリック セットがあります。

#### <a name="value-prediction"></a>値の予測

値の予測問題の既定のメトリックは RSquared で、RSquared の値の範囲は 0 から 1 です。 最適な値は 1 です。つまり、RSquared の値が 1 に近いほど、モデルのパフォーマンスが向上します。

絶対損失、二乗損失、RMS 損失など、報告されるその他のメトリックは追加メトリックで、モデルのパフォーマンスを理解し、それを他の値の予測モデルと比較する目的で使用できます。

#### <a name="classification-2-categories"></a>分類 (2 つのカテゴリ)

分類問題の既定のメトリックは正確度です。 正確度は、テスト データセットに基づいてモデルが正しく予測する比率を定めるものです。 100%、つまり 1.0 に近ければ近いほど、良いということになります。

真陽性率と擬陽性率を測定する AUC (曲線下面積) など、報告されるその他のメトリックは 0.50 以上であれば、モデルは許容されます。

F1 スコアなどの追加メトリックを使用すると、精度と再現率のバランスを制御できます。

#### <a name="classification-3-categories"></a>分類 (3 つ以上のカテゴリ)

多クラス分類の既定のメトリックはマイクロ正確度です。 マイクロ正確度が 100%、つまり 1.0 に近ければ近いほど、良いということになります。

多クラス分類のもう 1 つの重要なメトリックはマクロ正確度です。マイクロ正確度と同様、1.0 に近いほど良いことになります。 これらの 2 種類の正確度は次のように考えるとよいでしょう。

- マイクロ正確度: 受信チケットが、どのくらいの頻度で適切なチームに分類されるか。
- マクロ正確度: 平均的なチームが受け取るチケットが、そのチームにとって適切である頻度はどのくらいか。

### <a name="more-information-on-evaluation-metrics"></a>評価メトリックの詳細

詳しくは、[モデルの評価メトリック](resources/metrics.md)に関する記事をご覧ください。

## <a name="improve"></a>改善

モデルのパフォーマンス スコアが予想ほど良くない場合、次のことができます。

- トレーニングの時間を長くします。 時間を増やせば、自動化された機械学習エンジンによって実験されるアルゴリズムや設定が増えます。

- データを追加します。 高品質の機械学習モデルをトレーニングするにはデータ量が十分ではないことがあります。データセットの例の数が少ない場合は特にこれが当てはまります。

- データのバランスを調整します。 分類タスクの場合、カテゴリ全体でトレーニング セットのバランスが取れていることを確認します。 たとえば、100 のトレーニング例に対してクラスが 4 つあるとき、90 個のレコードに最初の 2 つのクラス (tag1 と tag2) を使用するが、残りの 2 つ (tag3 と tag4) は残りの 10 個のレコードでのみ使用する場合、データにバランスが欠け、tag3 か tag4 を正しく予測することがモデルにとって難しくなります。

## <a name="code"></a>コード

評価フェーズ後、モデル ビルダーからモデル ファイルとコードが出力されます。このコードを使用し、モデルをアプリケーションに追加できます。 ML.NET モデルは zip ファイルで保存されます。 モデルを読み込み、使用するためのコードがソリューションに新しいプロジェクトとして追加されます。 モデル ビルダーからはサンプル コンソール アプリも追加されます。これを実行すると、実際に動作するモデルを確認できます。

さらに、モデル ビルダーからはモデルを生成したコードが出力されます。モデルの生成に使用された手順を理解できます。 モデル トレーニング コードを使用し、モデルを新しいデータで再トレーニングすることもできます。

## <a name="whats-next"></a>次の内容

モデル ビルダーの Visual Studio 拡張機能の[インストール](how-to-guides/install-model-builder.md)

[価格予測または回帰のシナリオ](tutorials/predict-prices-with-model-builder.md)をお試しください。
