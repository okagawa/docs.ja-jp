---
title: サーバーレス関数の活用
description: クラウドネイティブアプリケーションでのサーバーレスと Azure Functions の活用
ms.date: 05/13/2020
ms.openlocfilehash: 53a0fdd29630b2a4368f3aa37ddfc5f93df10a24
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/19/2020
ms.locfileid: "83613864"
---
# <a name="leveraging-serverless-functions"></a>サーバーレス関数の活用

物理マシンの管理からクラウド機能の活用までの範囲では、サーバーレスは極端な端に存在します。 唯一の責任はコードです。コードの実行時にのみ課金されます。 Azure Functions は、クラウドネイティブアプリケーションにサーバーレス機能を構築する方法を提供します。

## <a name="what-is-serverless"></a>サーバーレスとは

サーバーレスは、クラウドコンピューティングの比較的新しいサービスモデルです。 サーバーは省略可能であるという意味ではありません。コードは、サーバー上のどこかで実行されます。 この違いは、アプリケーションチームがサーバーインフラストラクチャの管理について心配しなくなったことです。 代わりに、クラウドベンダーがこの責任を担います。 開発チームは、組み込みではなく、ビジネスソリューションを顧客に提供することによって生産性を向上させます。

サーバーレスコンピューティングでは、イベントによってトリガーされるステートレスコンテナーを使用してサービスをホストします。 必要に応じてスケールアウトしたり、需要を満たすことができます。 Azure Functions のようなサーバーレスプラットフォームは、キュー、イベント、ストレージなどの他の Azure サービスと緊密に統合されています。

## <a name="what-challenges-are-solved-by-serverless"></a>サーバーレスによって解決される課題

サーバーレスプラットフォームは、多くの時間とコストがかかる問題に対処します。

- 購入コンピューターとソフトウェアライセンス
- コンピューターとそのネットワーク、電力、および A/C の要件のハウジング、セキュリティ保護、構成、および保守
- オペレーティングシステムとソフトウェアの修正プログラムの適用とアップグレード
- アプリケーションソフトウェアをホストするための web サーバーまたはコンピューターサービスの構成
- プラットフォーム内でのアプリケーションソフトウェアの構成

多くの企業は、ハードウェアインフラストラクチャの問題をサポートするために大規模な予算を割り当てています。 クラウドに移行すると、これらのコストを削減できます。アプリケーションをサーバーレスに移行すると、アプリケーションを排除するのに役立ちます。

## <a name="what-is-the-difference-between-a-microservice-and-a-serverless-function"></a>マイクロサービスとサーバーレス関数の違いは何ですか。

通常、マイクロサービスは、オンラインの e コマースサイトのショッピングカートなどのビジネス機能をカプセル化します。 ユーザーがショッピング体験を管理できるようにする複数の操作を公開します。 ただし、関数は、イベントへの応答として単一の用途の操作を実行する、小さな軽量のコードブロックです。
通常、マイクロサービスは、要求に応答するように構成されます (多くの場合、インターフェイスから)。 要求は、HTTP Rest または gRPC ベースのいずれかになります。 サーバーレスサービスは、イベントに応答します。 イベントドリブンアーキテクチャは、実行時間の短いバックグラウンドタスクの処理に最適です。

## <a name="what-scenarios-are-appropriate-for-serverless"></a>サーバーレスに適したシナリオ

サーバーレスは、トリガーへの応答として呼び出される、個々の実行時間の短い関数を公開します。 これにより、バックグラウンドタスクの処理に最適です。

アプリケーションでは、ワークフローのステップとして電子メールを送信することが必要になる場合があります。 マイクロサービス要求の一部として通知を送信する代わりに、メッセージの詳細をキューに配置します。 Azure 関数は、メッセージをデキューし、電子メールを非同期に送信することができます。 これにより、マイクロサービスのパフォーマンスとスケーラビリティが向上します。 [キューベースの負荷平準化](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling)を実装すると、電子メールの送信に関連するボトルネックを回避できます。 さらに、このスタンドアロンサービスは、さまざまなアプリケーションでユーティリティとして再利用される可能性があります。

キューとトピックからの非同期メッセージングは、サーバーレス機能をトリガーするための一般的なパターンです。 ただし、Azure Functions は、Azure Blob Storage への変更など、他のイベントによってトリガーされる場合があります。 イメージのアップロードをサポートするサービスには、イメージサイズの最適化を担当する Azure 関数がある場合があります。 関数は Azure Blob Storage に挿入することによって直接トリガーされるため、マイクロサービスの操作が複雑になることはありません。

多くのサービスには、ワークフローの一部として長時間実行されるプロセスがあります。 多くの場合、これらのタスクは、アプリケーションとのユーザー操作の一部として実行されます。 これらのタスクを実行すると、ユーザーのエクスペリエンスに悪影響を与える可能性があります。 サーバーレスコンピューティングは、ユーザー操作ループの外側で低速タスクを移動する優れた方法を提供します。 これらのタスクは、アプリケーション全体の規模を調整することなく、必要に応じてスケールできます。

## <a name="when-should-you-avoid-serverless"></a>サーバーレスを避ける必要がある場合

サーバーレスソリューションは、オンデマンドでプロビジョニングし、スケーリングします。 新しいインスタンスが呼び出されると、コールドスタートが一般的な問題になります。 コールドスタートとは、このインスタンスのプロビジョニングにかかる時間のことです。 通常、この遅延は数秒である可能性がありますが、さまざまな要因によってはより長い時間がかかることがあります。 プロビジョニングが完了すると、定期的な要求を受信している限り、1つのインスタンスが保持されます。 ただし、サービスが呼び出される頻度が低い場合は、Azure によってメモリから削除され、再起動時にコールドスタートが必要になることがあります。 コールドスタートは、関数が新しいインスタンスにスケールアウトする場合にも必要です。

図3-10 は、コールドスタートパターンを示しています。 アプリがコールドである場合に必要な追加の手順に注意してください。

![コールドスタートとウォームスタート ](./media/cold-start-warm-start.png)
 の**図 3-10**。 コールドスタートとウォームスタート。

コールドスタートを完全に回避するには、[従量課金プランから専用プランに](https://azure.microsoft.com/blog/understanding-serverless-cold-start/)切り替えることができます。 Premium プランのアップグレードを使用して、1つまたは複数の事前設定された[med-v インスタンス](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances)を構成することもできます。 このような場合は、別のインスタンスを追加する必要があるときに、既に稼働状態になっています。 これらのオプションは、サーバーレスコンピューティングに関連するコールドスタートの問題を軽減するのに役立ちます。

クラウドプロバイダーは、コンピューティングの実行時間とメモリの消費量に基づいて、サーバーレスに課金されます。 実行時間の長い操作や大量のメモリ消費量のワークロードは、常にサーバーレスに最適な候補ではありません。 サーバーレス関数を使用すると、短時間で完了することができます。 ほとんどのサーバーレスプラットフォームでは、数分以内に個々の機能が完了する必要があります。 Azure Functions 既定値は5分間のタイムアウト期間です。これは10分まで構成できます。 Azure Functions premium プランでもこの問題を軽減できます。既定のタイムアウトを30分に設定すると、無制限に構成できます。 コンピューティング時間はカレンダー時間ではありません。 [Azure Durable Functions framework](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?tabs=csharp)を使用する高度な関数は、数日後に実行を一時停止することがあります。 課金は実際の実行時間に基づいて行います。関数がウェイクアップし、処理が再開されます。

最後に、アプリケーションタスクに Azure Functions を利用することで、複雑さが増します。 最初に、モジュール化された疎結合設計を使用してアプリケーションを設計することをお勧めします。 次に、サーバーレスが追加の複雑さを正当化する利点があるかどうかを確認します。

>[!div class="step-by-step"]
>[前へ](leverage-containers-orchestrators.md)
>[次へ](combine-containers-serverless-approaches.md)
