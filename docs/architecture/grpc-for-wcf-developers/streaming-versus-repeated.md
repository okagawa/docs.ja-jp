---
title: ストリーミング サービスと繰り返しフィールド - WCF 開発者向け gRPC
description: gRPC を使用してデータのコレクションを渡す方法として、繰り返しフィールドをストリーミング サービスと比較します。
ms.date: 09/02/2019
ms.openlocfilehash: 542ebc393f9c9c1ad717d02d01fab33d85c18917
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/12/2020
ms.locfileid: "79147751"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a>gRPC ストリーミングサービスと繰り返しフィールド

gRPC サービスは、データセットまたはオブジェクトのリストを返す 2 つの方法を提供します。 プロトコル バッファ メッセージ仕様では、`repeated`別のメッセージ内のメッセージのリストまたは配列を宣言するキーワードを使用します。 gRPC サービス仕様では、`stream`このキーワードを使用して、長時間実行される永続接続を宣言します。 この接続を介して、複数のメッセージが送信され、個別に処理できます。

また、通知`stream`やログ メッセージなどの長時間実行されるテンポラル データにこの機能を使用することもできます。 しかし、この章では、単一のデータセットを返す際の使用について検討します。

どちらを使用するかは、次のような要因によって異なります。

- データセットの全体的なサイズ。
- クライアント側またはサーバー側でデータセットを作成するのにかかった時間。
- データセットのコンシューマーが、最初の項目が使用可能になるとすぐにデータセットの処理を開始できるのか、または有用な操作を行うために完全なデータセットが必要か。

## <a name="when-to-use-repeated-fields"></a>フィールドを使用`repeated`する場合

サイズが制限され、短時間で全体を生成できるデータセット (たとえば 1 秒以下) の場合は、通常の`repeated`Protobuf メッセージのフィールドを使用する必要があります。 たとえば、e コマース システムでは、注文内のアイテムのリストを作成するのも、大きなサイズにならないことが多いと考えられます。 フィールドを含む単一`repeated`のメッセージを返す方が、使用`stream`するよりも 1 桁の速度が速く、ネットワークオーバーヘッドが少なくなります。

クライアントが処理を開始する前にすべてのデータを必要とし、データセットがメモリ内で構築できるほど小さい場合は、`repeated`フィールドの使用を検討してください。 サーバー上のメモリ内のデータセットの作成が遅い場合でも、この点を考慮してください。

## <a name="when-to-use-stream-methods"></a>メソッドを使用`stream`する場合

データセット内のメッセージ オブジェクトが非常に大きい可能性がある場合は、ストリーミング要求または応答を使用して転送することをお勧めします。 メモリ内に大きなオブジェクトを構築し、ネットワークに書き込み、リソースを解放する方が効率的です。 この方法を使用すると、サービスのスケーラビリティが向上します。

同様に、制約のないサイズのデータセットをストリームに送信して、構成中にメモリ不足が発生しないようにする必要があります。

コンシューマーが各項目を個別に処理できるデータセットの場合、進行状況をユーザーに示すことができる場合は、ストリームの使用を検討する必要があります。 ストリームを使用すると、アプリケーションの応答性を向上させることができますが、アプリケーションの全体的なパフォーマンスとのバランスを取る必要があります。

ストリームが役立つもう 1 つのシナリオは、メッセージが複数のサービスで処理されている場合です。 チェーン内の各サービスがストリームを返す場合、ターミナル サービス (つまり、チェーンの最後のサービス) がメッセージを返し始めることができます。 これらのメッセージは処理され、チェーンに沿って元のリクエスターに戻すことができます。 リクエスタは、ストリームを返すか、結果を単一の応答メッセージに集約できます。 このアプローチは、MapReduce のようなパターンに適しています。

>[!div class="step-by-step"]
>[前次](migrate-duplex-services.md)
>[Next](client-libraries.md)
